{"version":3,"sources":["components/designsystem/SmallInput.tsx","components/designsystem/Select.tsx","styled/animations.tsx","components/widgets/KofiButton.tsx","components/layout/infinite/InfiniteColumn.tsx","components/designsystem/Slider.tsx","icons/PlayPauseIcon.tsx","components/player/ToggleFullscreenButton.tsx","components/player/LinkList.tsx","components/player/FullscreenProgressBar.tsx","components/player/Overlay.tsx","components/player/ProgressBar.tsx","components/designsystem/FlexVideo.tsx","components/player/media/StyledMedia.ts","components/player/media/Picture.tsx","hooks/useIsScrolling.tsx","hooks/useAutoplay.tsx","hooks/useIsOnScreen.tsx","components/player/media/Gif.tsx","components/player/media/Video.tsx","components/player/Media.tsx","hooks/useSources.tsx","components/post/source/FallbackSource.tsx","components/designsystem/ColoredIconLink.tsx","components/post/source/LinkSource.tsx","components/post/source/sourceUtils.ts","icons/PixivIcon.tsx","components/post/source/SpecialLinkSource.tsx","components/post/source/Source.tsx","components/post/details/AdditonalDetails.tsx","components/post/details/Comments.tsx","components/post/details/Metadata.tsx","components/post/details/Rating.tsx","components/post/details/Score.tsx","components/post/details/Details.tsx","components/post/Post.tsx","components/designsystem/SubtleInput.tsx","components/features/Options.tsx","components/widgets/SearchButton.tsx","hooks/useConnectionState.tsx","components/features/Config.tsx","components/widgets/RandomTip.tsx","components/widgets/UpdateHighlight.tsx","components/widgets/SearchPlaceholder.tsx","components/widgets/ResultsTitle.tsx","components/layout/LayoutHeader.tsx","components/layout/LayoutOutOfItems.tsx","components/layout/LayoutLoadingItem.tsx","components/layout/pages/PageNavigation.tsx","components/layout/pages/PageLayout.tsx","components/reader/Reader.tsx","hooks/useFullscreenCloseEffect.tsx","components/pages/Search.tsx"],"names":["StyledInput","styled","input","theme","css","defaultBorder","colors","backgroundColor2","defaultBlock","SmallNumberInput","props","value","onSubmit","className","useState","toString","internalValue","setInternalValue","useEffect","onChange","useCallback","event","target","onBlur","Number","blurOnEnter","key","blur","type","onKeyDown","Wrapper","div","dimensions","blockHeight","StyledSelect","select","Option","option","Select","options","Object","entries","map","optionKey","optionValue","fadeOut","keyframes","kofiWiggle","Container","AButton","a","layerBg","borderRadius","text","Text","span","Image","img","KofiButton","id","label","title","href","rel","src","alt","cache","CellMeasurerCache","fixedWidth","InifinteColumn","Header","items","LoadingItem","hasMoreRows","ItemComponent","loadMore","OutOfItems","isLoading","setLoading","prependedRows","rowCount","length","isRowLoaded","index","rowRenderer","parent","style","columnIndex","rowIndex","measure","registerChild","virtualRef","onLoad","console","warn","handleResize","size","clearAll","loadMoreRows","params","Promise","reject","resolve","setTimeout","onRowsRendered","onResize","disableHeight","width","height","isScrolling","onChildScroll","scrollTop","autoHeight","onScroll","ref","deferredMeasurementCache","overscanRowCount","rowHeight","Slider","$controls","$accent","accentColor","trackStyle","commonStyle","thumbStyle","MorphSvg","svg","ExpandButton","ExpandIcon","dropShadow","gutter","CloseButton","CloseIcon","ToggleFullscreenButton","dispatch","useDispatch","isInFullscreen","useSelector","selectFullsceenState","onFullscreenExit","React","stopPropagation","exitFullscreen","onFullscreenEnter","enterFullscreen","color","onClick","DownloadButton","DownloadIcon","LinkList","fullSrc","handleDownload","download","isVisible","VideoProgressBar","isPaused","videoRef","onEnded","sliderRef","useRef","useTheme","handleChange","newValue","handleClick","addEventListener","removeEventListener","handle","requestAnimationFrame","step","current","currentTime","chromePercentage","Math","round","duration","backgroundImage","cancelAnimationFrame","min","max","AutoProgressBar","mouseState","setMouseState","setPost","newIndex","setFullscreenPost","listener","document","then","Date","getTime","renderFrame","now","log","NO_OP","PlayButton","viewBox","xmlns","x","y","LengthDisplay","spacing","ImageOverlay","isFullscreen","GifOverlay","onTogglePaused","VideoOverlay","onSeek","handleEnded","formatDuration","getOverlayContent","Overlay","setVisible","toggleVisible","FlexVideo","video","flexMedia","preserveAspectRatio","PostVideo","mediaStyle","PostImage","FlexImage","Picture","viewSrc","loading","timeoutId","isScrollingGlobal","observers","useAutoplay","playing","setPlaying","autoPlay","selectAutoPlay","isOnScreen","setOnScreen","handleOnScreenChange","entry","isIntersecting","observer","IntersectionObserver","threshold","root","observe","unobserve","useIsOnScreen","setIsScrolling","undefined","e","forEach","update","clearTimeout","passive","push","filter","useIsScrolling","Gif","thumbnailSrc","detailsVisible","overlayVisible","setOverlayVisible","userPlay","setUserPlay","togglePlay","gifRef","setGifRef","isPlaying","preload","selectPreloadGifs","usedSource","Video","setVideoRef","selectPreloadVideos","paused","play","pause","handleSeek","controls","loop","onLoadedMetadata","Media","sampleSrc","loadOriginals","selectOriginals","useMemo","includes","useSources","preview","FallbackSource","FlexPair","ColoredIconLink","flexRowWithGap","DefaultLinkSource","formatSource","extractFirstElement","split","sources","TwitterIcon","fill","d","PatreonIcon","path","startsWith","extractSecondElement","DeviantArtIcon","DiscordIcon","TumblrIcon","URL","hostname","SpecialLinkSource","Icon","Source","parseUrl","links","link","source","keys","find","getTitle","AdditionalDetails","flexColumnWithGap","Comment","flexColumnGap","Username","Message","Faded","Comments","comments","comment","creator","body","Entry","Metadata","created_at","status","createdAt","formatDatetime","formatTime","fullnames","q","s","Rating","toUpperCase","ScorePair","$liked","liked","Score","postId","selectLikedByPostId","likePost","formatCount","boolToNumber","Bar","layer","flexRowGap","hugeSpacing","Menu","MenuEntry","active","DetailsTagList","TagList","Details","activeTab","setActiveTab","hasComments","selectPostById","rating","score","tags","tagsForRendering","listToMap","tag","name","types","showMetadata","selectShowMetadata","showComments","selectShowComments","checkIsActive","useCheckIsActive","commentsLength","toggleTag","useToggleTag","setTags","setComments","setMetadata","detailed","onTagClick","getIsActive","metadata","ItemWrapper","PositonWrapper","bodyWidth","PostWrapper","ListPost","sample_url","file_url","preview_url","has_comments","Post","memo","useToggle","collapsed","toggleCollapsed","fetchComments","role","SubtleInput","backgroundColor","fontSizes","content","OptionsWrapper","gridWithGap","RatedRow","SortRow","sortOptions","date","Options","usePreference","rated","setRated","ratedThreshold","setRatedThreshold","sort","setSort","toggleRated","ratedThresholdInternal","setRatedThresholdInternal","handleSubmit","handleSortChange","LabeledToggle","onToggle","isUserNotified","SearchButton","search","useAction","getResults","history","useHistory","connection","navigator","mozConnection","webkitConnection","connectionState","setConnectionState","useConnectionState","preloadVideos","autoplay","originals","openModal","ModalId","CELLULAR_WARNING","pathname","RouteName","SEARCH","hash","ConfigWrapper","section","flexColumn","centeredMaxWidth","Config","useFirebaseAuthState","isSignedIn","activateTag","useActivateTag","htmlFor","Surface","TagSelector","showSupertags","ActiveTags","offerSupertags","tips","Span","getRandomTip","floor","random","RandomTip","tip","setTip","nextTip","deadline","UpdateHighlight","Placeholder","SearchPlaceholder","ClickableTitle","Title","ResultsTitle","fullNumber","toggleFullNumber","count","selectCount","formattedCount","toLocaleString","LayoutHeader","Div","StyledSurface","StyledImage","LayoutOutOfItems","aliases","selectAliasesAsList","aliasesForRendering","reduce","result","alias","outOfResultsPicture","LayoutLoadingItem","Loading","PageRow","Left","Right","PageNumber","RedButton","CurrentNumber","PageNavigation","currentPage","loadPage","lastPage","selectLastPage","loadSpecificPage","newPage","loadFirst","loadLast","loadPrevious","loadNext","FlexColumn","BaseFlexColumn","PageLayout","header","scrollAndLoadPage","getElementsByClassName","scrollIntoView","item","FullScreenDiv","Reader","posts","selectPosts","isReaderOpen","selectFullScreenIndex","fullScreenPost","selectFullScreenPost","fullScreenIndex","getMoreResults","readerRef","setReaderRef","useThrottledEffect","fullscreenElement","openFullscreen","effect","exit","handler","Search","hasMorePosts","selectHasMoreResults","resultsLayout","selectResultsLayout","pageSize","selectPageSize","pageNumber","selectPageNumber","hasMorePages"],"mappings":"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","file":"static/js/4.16d6be7a.chunk.js","sourcesContent":["import React, { ChangeEventHandler, useCallback, useEffect, useState } from 'react'\nimport styled, { css } from 'styled-components'\nimport { defaultBorder, defaultBlock } from '../../styled/mixins'\n\nconst StyledInput = styled.input(\n  ({ theme }) => css`\n    width: 70px;\n    ${defaultBorder({ theme })}\n    background-color: ${theme.colors.backgroundColor2};\n    ${defaultBlock({ theme })}\n    text-align: left;\n  `\n)\n\ninterface SmallInputProps<T> {\n  value: T\n  onSubmit: (value: T) => void\n  className?: string\n}\n\nexport function SmallTextInput(props: SmallInputProps<string>) {\n  const { value, onSubmit, className } = props\n  const [internalValue, setInternalValue] = useState(value)\n\n  useEffect(() => {\n    setInternalValue(value)\n  }, [value])\n\n  const onChange: ChangeEventHandler<HTMLInputElement> = useCallback((event) => {\n    setInternalValue(event.target.value)\n  }, [])\n\n  const onBlur = useCallback(() => {\n    onSubmit(internalValue)\n  }, [internalValue, onSubmit])\n\n  const blurOnEnter = useCallback((event) => {\n    if (event.key === 'Enter') {\n      event.target.blur()\n    }\n  }, [])\n\n  return (\n    <StyledInput\n      type='text'\n      value={internalValue}\n      onChange={onChange}\n      onBlur={onBlur}\n      onKeyDown={blurOnEnter}\n      className={className}\n    />\n  )\n}\n\nexport function SmallNumberInput(props: SmallInputProps<number>) {\n  const { value, onSubmit, className } = props\n  const [internalValue, setInternalValue] = useState(value.toString())\n\n  useEffect(() => {\n    setInternalValue(value.toString())\n  }, [value])\n\n  const onChange: ChangeEventHandler<HTMLInputElement> = useCallback((event) => {\n    setInternalValue(event.target.value)\n  }, [])\n\n  const onBlur = useCallback(() => {\n    onSubmit(Number(internalValue))\n  }, [internalValue, onSubmit])\n\n  const blurOnEnter = useCallback((event) => {\n    if (event.key === 'Enter') {\n      event.target.blur()\n    }\n  }, [])\n\n  return (\n    <StyledInput\n      type='number'\n      value={internalValue}\n      onChange={onChange}\n      onBlur={onBlur}\n      onKeyDown={blurOnEnter}\n      className={className}\n    />\n  )\n}\n","import React, { ChangeEventHandler } from 'react'\nimport styled, { css } from 'styled-components'\nimport { defaultBorder, defaultBlock } from '../../styled/mixins'\n\nconst Wrapper = styled.div(\n  ({ theme }) => css`\n    width: 100px;\n    height: ${theme.dimensions.blockHeight};\n  `\n)\n\nconst StyledSelect = styled.select(\n  ({ theme }) => css`\n    ${defaultBorder({ theme })}\n    ${defaultBlock({ theme })}\n    width: 100%;\n    height: 100%;\n    background-color: ${theme.colors.backgroundColor2};\n    cursor: pointer;\n  `\n)\n\nconst Option = styled.option(\n  ({ theme }) => css`\n    ${defaultBorder({ theme })}\n    background-color: ${theme.colors.backgroundColor2};\n    ${defaultBlock({ theme })}\n  `\n)\n\ninterface SelectProps {\n  options: Record<string, string>\n  value: string\n  onChange: ChangeEventHandler\n}\n\nexport default function Select(props: SelectProps) {\n  const { options, value, onChange } = props\n\n  return (\n    <Wrapper>\n      <StyledSelect value={value} onChange={onChange}>\n        {Object.entries(options).map(([optionKey, optionValue]) => (\n          <Option key={optionKey} value={optionKey}>\n            {optionValue}\n          </Option>\n        ))}\n      </StyledSelect>\n    </Wrapper>\n  )\n}\n","import { keyframes } from 'styled-components'\n\nexport const fadeOut = keyframes`\n  from {\n    opacity: 1;\n  }\n\n  to {\n    opacity: 0;\n  }\n`\n\nexport const kofiWiggle = keyframes`\n  0% {\n    transform: rotate(0) scale(1);\n  }\n  60% {\n    transform: rotate(0) scale(1);\n  }\n  75% {\n    transform: rotate(0) scale(1.12);\n  }\n  80% {\n    transform: rotate(0) scale(1.1);\n  }\n  84% {\n    transform: rotate(-10deg) scale(1.1);\n  }\n  88% {\n    transform: rotate(10deg) scale(1.1);\n  }\n  92% {\n    transform: rotate(-10deg) scale(1.1);\n  }\n  96% {\n    transform: rotate(10deg) scale(1.1);\n  }\n  100% {\n    transform: rotate(0) scale(1);\n  }\n`\n","import React from 'react'\nimport styled, { css } from 'styled-components'\nimport { kofiWiggle } from '../../styled/animations'\n\nconst Container = styled.div`\n  display: inline-block;\n  white-space: nowrap;\n`\n\nexport const AButton = styled.a(\n  ({ theme }) => css`\n    box-shadow: 1px 1px 0px rgba(0, 0, 0, 0.2);\n    line-height: 36px;\n    display: inline-block;\n    background-color: ${theme.colors.layerBg};\n    padding: 2px 12px;\n    text-align: center;\n    border-radius: ${theme.dimensions.borderRadius};\n    color: ${theme.colors.text};\n    cursor: pointer;\n    overflow-wrap: break-word;\n    vertical-align: middle;\n    border: 0 none #fff;\n    font-family: 'Quicksand', Helvetica, Century Gothic, sans-serif !important;\n    text-decoration: none;\n    text-shadow: none;\n    font-weight: 700;\n    font-size: 14px;\n\n    :visited {\n      color: ${theme.colors.text} !important;\n      text-decoration: none !important;\n    }\n\n    :hover {\n      opacity: 0.8;\n      text-decoration: none !important;\n    }\n\n    :active {\n      opacity: 0.6;\n      text-decoration: none !important;\n    }\n  `\n)\n\nconst Text = styled.span`\n  letter-spacing: -0.15px !important;\n  vertical-align: middle;\n  line-height: 33px !important;\n  padding: 0;\n  text-align: center;\n  text-decoration: none !important;\n  text-shadow: 0 1px 1px rgba(34, 34, 34, 0.05);\n\n  a {\n    text-decoration: none !important;\n  }\n\n  a:hover {\n    text-decoration: none;\n  }\n`\n\nconst Image = styled.img`\n  display: initial !important;\n  vertical-align: middle;\n  height: 13px !important;\n  width: 20px !important;\n  padding-top: 0;\n  padding-bottom: 0;\n  border: none;\n  margin-top: 0;\n  margin-right: 5px;\n  margin-left: 0;\n  margin-bottom: 3px;\n  content: url('https://ko-fi.com/img/cup-border.png');\n\n  :after {\n    vertical-align: middle;\n    height: 25px;\n    padding-top: 0;\n    padding-bottom: 0;\n    border: none;\n    margin-top: 0;\n    margin-right: 6px;\n    margin-left: 0;\n    margin-bottom: 4px !important;\n    content: url('https://ko-fi.com/img/whitelogo.svg');\n\n    height: 15px !important;\n    width: 22px !important;\n    display: initial;\n    animation: ${kofiWiggle} 3s infinite;\n  }\n`\n\ninterface KofiButtonProps {\n  id: string\n  label: string\n}\n\nexport default function KofiButton(props: KofiButtonProps) {\n  const { id, label } = props\n\n  return (\n    <Container>\n      <AButton title={label} href={'https://ko-fi.com/' + id} target='_blank' rel='noopener noreferrer'>\n        <Text>\n          <Image src='https://ko-fi.com/img/cup-border.png' className='kofiimg' alt='Ko-Fi button' />\n          {label}\n        </Text>\n      </AButton>\n    </Container>\n  )\n}\n","import React, { useCallback } from 'react'\nimport {\n  AutoSizer,\n  CellMeasurer,\n  CellMeasurerCache,\n  IndexRange,\n  InfiniteLoader,\n  List,\n  WindowScroller,\n} from 'react-virtualized'\nimport LayoutElementProps from '../LayoutElementProps'\n\nconst cache = new CellMeasurerCache({\n  fixedWidth: true,\n})\n\ninterface InfiniteColumnProps<T> {\n  Header?: (props: LayoutElementProps) => JSX.Element\n  OutOfItems?: (props: LayoutElementProps) => JSX.Element\n  items?: T[]\n  LoadingItem: (props: LayoutElementProps) => JSX.Element\n  hasMoreRows: boolean\n  loadMore: () => void\n  ItemComponent: (props: T & LayoutElementProps & { index: number }) => JSX.Element\n  isLoading: boolean\n  setLoading: (value: boolean) => void\n}\n\nexport default function InifinteColumn<T>(props: InfiniteColumnProps<T>) {\n  const {\n    Header,\n    items = [],\n    LoadingItem,\n    hasMoreRows,\n    ItemComponent,\n    loadMore,\n    OutOfItems,\n    isLoading,\n    setLoading,\n  } = props\n\n  const prependedRows = Header ? 1 : 0\n  const loadingRows = 1\n  const rowCount = items.length + prependedRows + loadingRows\n\n  const isRowLoaded = useCallback(\n    ({ index }: { index: number }) => index < prependedRows + items.length + (hasMoreRows ? 0 : 1),\n    [hasMoreRows, items.length, prependedRows]\n  )\n\n  const rowRenderer = useCallback(\n    ({ index, key, parent, style }: { index: number; key: any; parent: any; style: any }) => {\n      return (\n        <CellMeasurer cache={cache} columnIndex={0} key={key} rowIndex={index} parent={parent}>\n          {({ measure, registerChild }) => {\n            // Index 0\n            if (Header && index < prependedRows) {\n              return <Header style={style} virtualRef={registerChild} onLoad={measure} />\n            }\n\n            // Index 1\n            if (index < prependedRows + items.length) {\n              return (\n                <ItemComponent\n                  style={style}\n                  virtualRef={registerChild}\n                  onLoad={measure}\n                  index={index - prependedRows}\n                  {...items[index - prependedRows]}\n                />\n              )\n            }\n\n            // Index 2\n            if (index < prependedRows + items.length + loadingRows) {\n              return hasMoreRows || isLoading ? (\n                <LoadingItem style={style} virtualRef={registerChild} onLoad={measure} />\n              ) : OutOfItems && items.length > 0 ? (\n                <OutOfItems style={style} virtualRef={registerChild} onLoad={measure} />\n              ) : (\n                <div></div>\n              )\n            }\n\n            console.warn('index not found / out of bounds. INDEX:', index)\n            return null\n          }}\n        </CellMeasurer>\n      )\n    },\n    [Header, prependedRows, items, ItemComponent, hasMoreRows, isLoading, LoadingItem, OutOfItems]\n  )\n\n  const loadMoreRows = (params: IndexRange) => {\n    if (isLoading || !hasMoreRows) {\n      return Promise.reject(0)\n    }\n\n    setLoading(true)\n    loadMore()\n\n    return new Promise((resolve) => {\n      setTimeout(() => {\n        setLoading(false)\n        resolve(1)\n      }, 1000)\n    })\n  }\n\n  const handleResize = useCallback((size) => {\n    cache.clearAll()\n  }, [])\n\n  return (\n    <InfiniteLoader isRowLoaded={isRowLoaded} loadMoreRows={loadMoreRows} rowCount={rowCount}>\n      {({ onRowsRendered, registerChild }) => {\n        return (\n          <AutoSizer onResize={handleResize} disableHeight>\n            {({ width }) => {\n              return (\n                <WindowScroller>\n                  {({ height, isScrolling, onChildScroll, scrollTop }) => {\n                    return (\n                      <List\n                        autoHeight\n                        height={height}\n                        isScrolling={isScrolling}\n                        onScroll={onChildScroll}\n                        scrollTop={scrollTop}\n                        ref={registerChild}\n                        onRowsRendered={onRowsRendered}\n                        rowRenderer={rowRenderer}\n                        deferredMeasurementCache={cache}\n                        overscanRowCount={10}\n                        rowCount={items.length + prependedRows + loadingRows}\n                        rowHeight={cache.rowHeight}\n                        width={width}\n                      />\n                    )\n                  }}\n                </WindowScroller>\n              )\n            }}\n          </AutoSizer>\n        )\n      }}\n    </InfiniteLoader>\n  )\n}\n","import styled, { DefaultTheme, css } from 'styled-components'\r\n\r\nfunction thumbStyle({ $controls, theme }: { $controls: boolean; theme: DefaultTheme }) {\r\n  const commonStyle = css`\r\n    height: 16px;\r\n    width: 16px;\r\n    border-radius: 100px;\r\n    background: ${$controls ? theme.colors.backgroundColor2 : 'transparent'};\r\n    cursor: pointer;\r\n  `\r\n\r\n  return css`\r\n    &::-webkit-slider-thumb {\r\n      -webkit-appearance: none;\r\n      ${commonStyle}\r\n    }\r\n\r\n    &::-moz-range-thumb {\r\n      ${commonStyle}\r\n    }\r\n\r\n    &::-ms-thumb {\r\n      ${commonStyle}\r\n    }\r\n  `\r\n}\r\n\r\nfunction trackStyle({ $accent, theme }: { $accent: boolean; theme: DefaultTheme }) {\r\n  return css`\r\n    -webkit-appearance: none;\r\n    flex-grow: 1;\r\n    background: ${(props) => props.theme.colors.layerBg};\r\n    border-radius: 100px;\r\n    height: 6px;\r\n\r\n    &::-moz-range-progress {\r\n      background-color: ${$accent ? theme.colors.accentColor : theme.colors.backgroundColor2};\r\n    }\r\n\r\n    &::-ms-fill-lower {\r\n      background-color: ${$accent ? theme.colors.accentColor : theme.colors.backgroundColor2};\r\n    }\r\n  `\r\n}\r\n\r\nexport const Slider = styled.input(\r\n  ({ $controls, $accent, theme }: { $controls: boolean; $accent: boolean; theme: DefaultTheme }) => css`\r\n    ${trackStyle({ $accent, theme })}\r\n    ${thumbStyle({ $controls, theme })}\r\n  `\r\n)\r\n","import React, { MouseEventHandler } from 'react'\r\nimport styled from 'styled-components'\r\nimport { NO_OP } from '../data/types'\r\n\r\ninterface PlayPauseIconProps {\r\n  className?: string\r\n  isPaused: boolean\r\n  onClick: MouseEventHandler<SVGElement>\r\n}\r\n\r\nconst MorphSvg = styled.svg`\r\n  > rect {\r\n    transition: all 0.2s ease-in;\r\n  }\r\n\r\n  &.play {\r\n    .left {\r\n      clip-path: path('M1.61 0 L10.1 4.9 L10.1 19.1 L1.61 24');\r\n    }\r\n\r\n    .right {\r\n      clip-path: path('M22.39 12 L9.9 4.79 L9.9 19.21 L22.39 12');\r\n    }\r\n  }\r\n\r\n  &.pause {\r\n    .left {\r\n      clip-path: path('M4.8 0 L10 0 L10 24 L4.8 24');\r\n    }\r\n\r\n    .right {\r\n      clip-path: path('M19.2 0 L14 0 L14 24 L19.2 24');\r\n    }\r\n  }\r\n`\r\n\r\n/**\r\n * A button that fluidly transforms between a Play and a Pause icon based on isPaused.\r\n * Use onClick to update isPaused.\r\n * Additionally, this component takes a classname\r\n */\r\nexport function PlayPauseIcon(props: PlayPauseIconProps) {\r\n  const { onClick = NO_OP, className = '', isPaused } = props\r\n\r\n  return (\r\n    <MorphSvg\r\n      viewBox='0 0 24 24'\r\n      xmlns='http://www.w3.org/2000/svg'\r\n      onClick={onClick}\r\n      className={`${className} ${isPaused ? 'play' : 'pause'}`}\r\n    >\r\n      <rect className='left' color='currentColor' x='0' y='0' width='24' height=' 24' />\r\n      <rect className='right' color='currentColor' x='0' y='0' width='24' height=' 24' />\r\n    </MorphSvg>\r\n  )\r\n}\r\n","import React from 'react'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport styled, { css } from 'styled-components'\r\nimport { ExpandIcon, CloseIcon } from '../../icons/FontAwesomeIcons'\r\nimport { exitFullscreen, enterFullscreen } from '../../redux/actions'\r\nimport { selectFullsceenState } from '../../redux/selectors'\r\nimport { dropShadow } from '../../styled/mixins'\r\n\r\nconst ExpandButton = styled(ExpandIcon)(\r\n  ({ theme }) => css`\r\n    grid-area: 1/1/2/2;\r\n    place-self: start start;\r\n    ${dropShadow}\r\n    margin: ${theme.dimensions.gutter};\r\n    cursor: pointer;\r\n  `\r\n)\r\n\r\nconst CloseButton = styled(CloseIcon)(\r\n  ({ theme }) => css`\r\n    grid-area: 1/1/2/2;\r\n    place-self: start start;\r\n    ${dropShadow}\r\n    margin: ${theme.dimensions.gutter};\r\n    cursor: pointer;\r\n  `\r\n)\r\n\r\ninterface ToggleFullscreenButtonProps {\r\n  index: number\r\n}\r\n\r\nexport default function ToggleFullscreenButton(props: ToggleFullscreenButtonProps) {\r\n  const { index } = props\r\n\r\n  const dispatch = useDispatch()\r\n  const isInFullscreen = useSelector(selectFullsceenState)\r\n\r\n  const onFullscreenExit = React.useCallback<React.MouseEventHandler>(\r\n    (event) => {\r\n      event.stopPropagation()\r\n      dispatch(exitFullscreen())\r\n    },\r\n    [dispatch]\r\n  )\r\n\r\n  const onFullscreenEnter = React.useCallback<React.MouseEventHandler>(\r\n    (event) => {\r\n      event.stopPropagation()\r\n      dispatch(enterFullscreen(index))\r\n    },\r\n    [dispatch, index]\r\n  )\r\n\r\n  return isInFullscreen ? (\r\n    <CloseButton color='white' onClick={onFullscreenExit} aria-label='Exit fullscreen' title='Exit fullscreen' />\r\n  ) : (\r\n    <ExpandButton color='white' onClick={onFullscreenEnter} aria-label='Enter fullscreen' title='Enter fullscreen' />\r\n  )\r\n}\r\n","import React from 'react'\r\nimport styled from 'styled-components'\r\nimport { download } from '../../data/utils'\r\nimport { DownloadIcon, ExternalLinkIcon } from '../../icons/FontAwesomeIcons'\r\nimport { gutter, dropShadow } from '../../styled/mixins'\r\n\r\nconst Wrapper = styled.div`\r\n  grid-area: 3/1/4/2;\r\n  place-self: end stretch;\r\n  display: flex;\r\n  place-items: start center;\r\n  ${gutter}\r\n\r\n  > svg {\r\n    ${dropShadow}\r\n  }\r\n`\r\n\r\nconst DownloadButton = styled(DownloadIcon)`\r\n  cursor: pointer;\r\n`\r\n\r\ninterface LinkListProps {\r\n  fullSrc: string\r\n}\r\n\r\nexport default function LinkList(props: LinkListProps) {\r\n  const { fullSrc } = props\r\n\r\n  const handleDownload = React.useCallback<React.MouseEventHandler>(\r\n    (event) => {\r\n      event.stopPropagation()\r\n      download(fullSrc)\r\n    },\r\n    [fullSrc]\r\n  )\r\n\r\n  return (\r\n    <Wrapper>\r\n      <a href={fullSrc} target='_blank' rel='noopener noreferrer' aria-label='Open In New Tab' title={fullSrc}>\r\n        <ExternalLinkIcon color='white' title='Open image in new tab' />\r\n      </a>\r\n\r\n      <DownloadButton color='white' aria-label='Download Image' onClick={handleDownload} title={fullSrc} />\r\n    </Wrapper>\r\n  )\r\n}\r\n","import React, { useCallback, useState } from 'react'\r\nimport { useDispatch } from 'react-redux'\r\nimport { NO_OP } from '../../data/types'\r\nimport { setFullscreenPost } from '../../redux/actions'\r\nimport { Slider } from '../designsystem/Slider'\r\n\r\nconst duration = 5000\r\n\r\ninterface FullscreenProgressBarProps {\r\n  className?: string\r\n  index: number\r\n  isPaused?: boolean\r\n}\r\n\r\nexport default function FullscreenProgressBar(props: FullscreenProgressBarProps) {\r\n  const [mouseState, setMouseState] = useState(false)\r\n  const dispatch = useDispatch()\r\n  const setPost = useCallback((newIndex) => dispatch(setFullscreenPost(newIndex)), [dispatch])\r\n\r\n  React.useEffect(() => {\r\n    const listener = () => setMouseState(true)\r\n    document.addEventListener('mousedown', listener)\r\n    document.addEventListener('touchstart', listener)\r\n\r\n    return () => {\r\n      document.removeEventListener('mousedown', listener)\r\n      document.removeEventListener('touchstart', listener)\r\n    }\r\n  })\r\n\r\n  React.useEffect(() => {\r\n    const listener = () => setMouseState(false)\r\n    document.addEventListener('mouseup', listener)\r\n    document.addEventListener('touchend', listener)\r\n\r\n    return () => {\r\n      document.removeEventListener('mouseup', listener)\r\n      document.removeEventListener('touchend', listener)\r\n    }\r\n  })\r\n\r\n  const ref = React.useRef<HTMLInputElement>(null)\r\n\r\n  React.useEffect(() => {\r\n    if (!mouseState) {\r\n      let handle: number\r\n      let then = new Date().getTime()\r\n\r\n      const renderFrame = () => {\r\n        if (ref.current) {\r\n          const now = new Date().getTime()\r\n          const newValue = Number(ref.current.value) + (now - then)\r\n          then = now\r\n\r\n          ref.current.value = newValue.toString()\r\n          const chromePercentage = Math.round((newValue / duration) * 100)\r\n          ref.current.style.backgroundImage = `linear-gradient(90deg, #ffffff80 ${chromePercentage}%, transparent ${chromePercentage}%)`\r\n\r\n          if (newValue >= Number(ref.current.max)) {\r\n            setPost(props.index + 1)\r\n            if (ref.current) {\r\n              ref.current.value = '0'\r\n            }\r\n          } else {\r\n            handle = requestAnimationFrame(renderFrame)\r\n          }\r\n        }\r\n      }\r\n\r\n      handle = requestAnimationFrame(renderFrame)\r\n\r\n      return () => {\r\n        console.log('removed interval')\r\n        cancelAnimationFrame(handle)\r\n      }\r\n    }\r\n  }, [mouseState, props.index, setPost])\r\n\r\n  return (\r\n    <Slider\r\n      ref={ref}\r\n      type='range'\r\n      step={0.034}\r\n      min={0}\r\n      max={duration}\r\n      onChange={NO_OP}\r\n      onClick={NO_OP}\r\n      $controls={false}\r\n      $accent={false}\r\n      className={props.className}\r\n    />\r\n  )\r\n}\r\n","import styled, { css } from 'styled-components'\nimport { fadeOut } from '../../styled/animations'\nimport { formatDuration } from '../../misc/formatting'\nimport { ProgressBar } from './ProgressBar'\nimport { dropShadow } from '../../styled/mixins'\nimport { PlayPauseIcon } from '../../icons/PlayPauseIcon'\nimport ToggleFullscreenButton from './ToggleFullscreenButton'\nimport LinkList from './LinkList'\nimport React from 'react'\nimport FullscreenProgressBar from './FullscreenProgressBar'\nimport { useDispatch } from 'react-redux'\nimport { setFullscreenPost } from '../../redux/actions'\n\nfunction overlayVisibility({ isVisible }: { isVisible: boolean }) {\n  return isVisible\n    ? css``\n    : css`\n        opacity: 0;\n        animation: ${fadeOut} 0.4s ease-in;\n      `\n}\n\nconst Wrapper = styled.div`\n  grid-area: 1/1/2/2;\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  grid-template-rows: auto 1fr auto auto;\n  z-index: 1;\n\n  ${overlayVisibility};\n`\n\nconst VideoProgressBar = styled(ProgressBar)(\n  ({ theme }) => css`\n    grid-area: 4/1/4/4;\n    margin: ${theme.dimensions.gutter};\n  `\n)\n\nconst AutoProgressBar = styled(FullscreenProgressBar)(\n  ({ theme }) => css`\n    grid-area: 4/1/4/4;\n    margin: ${theme.dimensions.gutter};\n  `\n)\n\nconst PlayButton = styled(PlayPauseIcon)`\n  height: 50px;\n  width: 50px;\n  grid-area: 2/2/3/3;\n  place-self: center center;\n  cursor: pointer;\n  fill: white;\n  ${dropShadow}\n`\n\nconst LengthDisplay = styled.span(\n  (props) => css`\n    grid-area: 3/3/4/4;\n    place-self: end end;\n    background: #00000080;\n    color: white;\n    border-radius: 4px;\n    padding: ${props.theme.dimensions.spacing};\n    margin: ${props.theme.dimensions.gutter};\n  `\n)\n\ntype ImageOverlayProps = {\n  type: 'image'\n  index: number\n  fullSrc: string\n  isFullscreen: boolean\n}\n\ntype GifOverlayProps = {\n  type: 'gif'\n  index: number\n  fullSrc: string\n  isPaused: boolean\n  onTogglePaused: React.MouseEventHandler\n  isFullscreen: boolean\n}\n\ntype VideoOverlayProps = {\n  type: 'video'\n  index: number\n  fullSrc: string\n  isPaused: boolean\n  duration: number\n  onTogglePaused: React.MouseEventHandler\n  onSeek: (value: number) => void\n  videoRef: HTMLVideoElement | null\n  isFullscreen: boolean\n}\n\ntype OverlayProps = (ImageOverlayProps | VideoOverlayProps | GifOverlayProps) & {\n  isVisible: boolean\n  setVisible: (value: boolean) => void\n}\n\nexport function ImageOverlay(props: Omit<ImageOverlayProps, 'type'>) {\n  const { index, fullSrc, isFullscreen } = props\n\n  return (\n    <>\n      <ToggleFullscreenButton index={index} />\n      <LinkList fullSrc={fullSrc} />\n      {isFullscreen && <AutoProgressBar index={index} />}\n    </>\n  )\n}\n\nfunction GifOverlay(props: Omit<GifOverlayProps, 'type'>) {\n  const { fullSrc, isPaused, index, onTogglePaused, isFullscreen } = props\n\n  return (\n    <>\n      <ToggleFullscreenButton index={index} />\n      <LinkList fullSrc={fullSrc} />\n      <PlayButton isPaused={isPaused} onClick={onTogglePaused} aria-label='Play/Pause' />\n      {isFullscreen && <AutoProgressBar index={index} isPaused={isPaused} />}\n      <LengthDisplay>GIF</LengthDisplay>\n    </>\n  )\n}\n\nfunction VideoOverlay(props: Omit<VideoOverlayProps, 'type'>) {\n  const { fullSrc, isPaused, index, onTogglePaused, onSeek, duration, videoRef, isFullscreen } = props\n\n  const dispatch = useDispatch()\n\n  const handleEnded = React.useCallback(() => {\n    if (isFullscreen) {\n      dispatch(setFullscreenPost(index + 1))\n    }\n  }, [dispatch, index, isFullscreen])\n\n  return (\n    <>\n      <ToggleFullscreenButton index={index} />\n      <LinkList fullSrc={fullSrc} />\n      <PlayButton isPaused={isPaused} onClick={onTogglePaused} aria-label='Play/Pause' />\n      <LengthDisplay>{formatDuration(duration)}</LengthDisplay>\n      <VideoProgressBar isPaused={isPaused} videoRef={videoRef} onChange={onSeek} onEnded={handleEnded} />\n    </>\n  )\n}\n\nfunction getOverlayContent(props: OverlayProps) {\n  switch (props.type) {\n    case 'image':\n      return <ImageOverlay {...props} />\n    case 'gif':\n      return <GifOverlay {...props} />\n    case 'video':\n      return <VideoOverlay {...props} />\n  }\n}\n\nexport function Overlay(props: OverlayProps) {\n  const { isVisible, setVisible } = props\n\n  const toggleVisible = React.useCallback(() => setVisible(!isVisible), [isVisible, setVisible])\n\n  return (\n    <Wrapper isVisible={isVisible} onClick={toggleVisible} data-testid='overlay-wrapper'>\n      {getOverlayContent(props)}\n    </Wrapper>\n  )\n}\n","import React, { ChangeEventHandler, MouseEventHandler, useCallback } from 'react'\r\nimport { useTheme } from 'styled-components'\r\nimport { Slider } from '../designsystem/Slider'\r\n\r\ninterface ProgressBarProps {\r\n  isPaused: boolean\r\n  videoRef: HTMLVideoElement | null\r\n  onChange: (newValue: number) => void\r\n  className?: string\r\n  onEnded?: () => void\r\n}\r\n\r\nexport const ProgressBar = (props: ProgressBarProps) => {\r\n  const { isPaused, videoRef, className, onChange, onEnded } = props\r\n\r\n  const sliderRef = React.useRef<HTMLInputElement>(null)\r\n\r\n  const theme = useTheme()\r\n\r\n  const handleChange: ChangeEventHandler<HTMLInputElement> = useCallback(\r\n    (event) => {\r\n      const newValue = Number(event.target.value)\r\n      onChange(newValue)\r\n    },\r\n    [onChange]\r\n  )\r\n\r\n  const handleClick: MouseEventHandler = useCallback((event) => {\r\n    event.stopPropagation()\r\n  }, [])\r\n\r\n  React.useEffect(() => {\r\n    if (onEnded && videoRef) {\r\n      videoRef.addEventListener('ended', onEnded)\r\n\r\n      return () => videoRef.removeEventListener('ended', onEnded)\r\n    }\r\n  })\r\n\r\n  React.useEffect(() => {\r\n    if (!isPaused) {\r\n      let handle: number\r\n\r\n      const step = () => {\r\n        if (sliderRef?.current && videoRef) {\r\n          sliderRef.current.value = videoRef.currentTime.toString()\r\n          const chromePercentage = Math.round((videoRef.currentTime / videoRef.duration) * 100)\r\n          sliderRef.current.style.backgroundImage = `linear-gradient(90deg, ${theme.colors.accentColor} ${chromePercentage}%, transparent ${chromePercentage}%)`\r\n        }\r\n\r\n        handle = requestAnimationFrame(step)\r\n      }\r\n\r\n      handle = requestAnimationFrame(step)\r\n\r\n      return () => {\r\n        cancelAnimationFrame(handle)\r\n      }\r\n    }\r\n  }, [isPaused, theme.colors.accentColor, theme.colors.backgroundColor2, videoRef])\r\n\r\n  return (\r\n    <Slider\r\n      ref={sliderRef}\r\n      type='range'\r\n      step={0.034}\r\n      min={0}\r\n      max={videoRef?.duration || 0}\r\n      onChange={handleChange}\r\n      className={className}\r\n      onClick={handleClick}\r\n      $controls\r\n      $accent\r\n    />\r\n  )\r\n}\r\n","import styled from 'styled-components'\nimport { flexMedia, preserveAspectRatio } from '../../styled/mixins'\n\nconst FlexVideo = styled.video`\n  ${flexMedia}\n  ${preserveAspectRatio}\n  grid-area: 1/1/2/2;\n`\n\nexport default FlexVideo\n","import styled from 'styled-components'\r\nimport { mediaStyle } from '../../../styled/mixins'\r\nimport FlexImage from '../../designsystem/FlexImage'\r\nimport FlexVideo from '../../designsystem/FlexVideo'\r\n\r\nexport const PostVideo = styled(FlexVideo)`\r\n  ${mediaStyle}\r\n`\r\n\r\nexport const PostImage = styled(FlexImage)`\r\n  ${mediaStyle}\r\n`\r\n","import React from 'react'\r\nimport { NO_OP } from '../../../data/types'\r\nimport { Overlay } from '../Overlay'\r\nimport { PostImage } from './StyledMedia'\r\n\r\ninterface PictureProps {\r\n  viewSrc: string\r\n  fullSrc: string\r\n  onLoad?: () => void\r\n  width: number\r\n  height: number\r\n  index: number\r\n  isFullscreen: boolean\r\n}\r\n\r\nexport default function Picture(props: PictureProps) {\r\n  const { viewSrc, fullSrc, index, onLoad = NO_OP, width, height, isFullscreen } = props\r\n\r\n  return (\r\n    <>\r\n      <PostImage\r\n        data-testid='image'\r\n        src={viewSrc}\r\n        alt={viewSrc}\r\n        onLoad={onLoad}\r\n        loading='lazy'\r\n        width={width}\r\n        height={height}\r\n      />\r\n      <Overlay\r\n        type='image'\r\n        fullSrc={fullSrc}\r\n        index={index}\r\n        isVisible={true}\r\n        setVisible={NO_OP}\r\n        isFullscreen={isFullscreen}\r\n      />\r\n    </>\r\n  )\r\n}\r\n","import React from 'react'\r\n\r\nlet isScrollingGlobal = false\r\nlet observers: React.Dispatch<React.SetStateAction<boolean>>[] = []\r\nlet listener: ((e: any) => void) | undefined\r\nlet timeoutId: NodeJS.Timeout | undefined\r\n\r\nexport const useIsScrolling = () => {\r\n  const [isScrolling, setIsScrolling] = React.useState(isScrollingGlobal)\r\n\r\n  if (listener === undefined) {\r\n    listener = (e) => {\r\n      isScrollingGlobal = true\r\n      observers.forEach((update) => update(isScrollingGlobal))\r\n\r\n      if (timeoutId) clearTimeout(timeoutId)\r\n\r\n      timeoutId = setTimeout(() => {\r\n        isScrollingGlobal = false\r\n        observers.forEach((update) => update(isScrollingGlobal))\r\n      }, 500)\r\n    }\r\n    document.addEventListener('scroll', listener, { passive: true })\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    observers.push(setIsScrolling)\r\n    setIsScrolling(isScrollingGlobal)\r\n    return () => {\r\n      observers = observers.filter((update) => update !== setIsScrolling)\r\n\r\n      if (observers.length === 0 && listener) {\r\n        document.removeEventListener('scroll', listener)\r\n        listener = undefined\r\n      }\r\n    }\r\n  }, [])\r\n\r\n  // return global isOnline state and setter function\r\n  return isScrolling\r\n}\r\n","import React from 'react'\r\nimport { useSelector } from 'react-redux'\r\nimport { selectAutoPlay } from '../redux/selectors'\r\nimport useIsOnScreen from './useIsOnScreen'\r\nimport { useIsScrolling } from './useIsScrolling'\r\n\r\nexport function useAutoplay(ref: Element | null) {\r\n  const [playing, setPlaying] = React.useState(false)\r\n\r\n  const autoPlay = useSelector(selectAutoPlay)\r\n  const [isOnScreen] = useIsOnScreen(ref)\r\n  const isScrolling = useIsScrolling()\r\n\r\n  React.useEffect(() => {\r\n    if (autoPlay && isOnScreen && !isScrolling) {\r\n      setPlaying(true)\r\n    }\r\n  }, [autoPlay, isOnScreen, isScrolling])\r\n\r\n  React.useEffect(() => {\r\n    if (!isOnScreen) {\r\n      setPlaying(false)\r\n    }\r\n  }, [isOnScreen])\r\n\r\n  return autoPlay && playing\r\n}\r\n","import { useCallback, useEffect, useState } from 'react'\r\n\r\nexport default function useIsOnScreen(target: Element | null, options?: IntersectionObserverInit) {\r\n  const [isOnScreen, setOnScreen] = useState(false)\r\n\r\n  const handleOnScreenChange = useCallback((entries: IntersectionObserverEntry[]) => {\r\n    const [entry] = entries\r\n    setOnScreen(entry.isIntersecting)\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    const observer = new IntersectionObserver(handleOnScreenChange, options || { threshold: 1, root: null })\r\n\r\n    if (target) {\r\n      observer.observe(target)\r\n    }\r\n\r\n    return () => {\r\n      if (target) {\r\n        observer.unobserve(target)\r\n      }\r\n    }\r\n  }, [handleOnScreenChange, options, target])\r\n\r\n  return [isOnScreen]\r\n}\r\n","import React, { useEffect, useState } from 'react'\nimport { NO_OP } from '../../../data/types'\nimport MediaProps from './MediaProps'\nimport { Overlay } from '../Overlay'\nimport { PostImage } from './StyledMedia'\nimport { useSelector } from 'react-redux'\nimport { selectPreloadGifs } from '../../../redux/selectors'\nimport { useAutoplay } from '../../../hooks/useAutoplay'\n\nexport default function Gif(props: MediaProps) {\n  const { viewSrc, thumbnailSrc, fullSrc, onLoad = NO_OP, index, width, height, detailsVisible, isFullscreen } = props\n\n  const [overlayVisible, setOverlayVisible] = React.useState(true)\n\n  // user play\n  const [userPlay, setUserPlay] = useState<boolean | null>(null)\n  const togglePlay: React.MouseEventHandler = React.useCallback(\n    (e) => {\n      e.stopPropagation()\n      setUserPlay(!userPlay)\n      setOverlayVisible(false)\n    },\n    [userPlay]\n  )\n\n  // auto play\n  const [gifRef, setGifRef] = useState<HTMLImageElement | null>(null)\n  const autoPlay = useAutoplay(gifRef)\n\n  const isPlaying = userPlay === undefined ? autoPlay : userPlay\n\n  // Preloading\n  const preload = useSelector(selectPreloadGifs)\n\n  const usedSource = isPlaying ? viewSrc : thumbnailSrc\n\n  useEffect(() => {\n    if (preload) {\n      const loader = new Image()\n      loader.src = viewSrc\n    }\n  })\n\n  return (\n    <>\n      <PostImage\n        data-testid='gif'\n        ref={setGifRef}\n        src={usedSource}\n        alt={usedSource}\n        loading='lazy'\n        onLoad={onLoad}\n        width={width}\n        height={height}\n      />\n\n      <Overlay\n        isVisible={!isPlaying || overlayVisible || detailsVisible}\n        setVisible={setOverlayVisible}\n        type='gif'\n        fullSrc={fullSrc}\n        index={index}\n        isPaused={!isPlaying}\n        onTogglePaused={togglePlay}\n        isFullscreen={isFullscreen}\n      />\n    </>\n  )\n}\n","import React, { useState } from 'react'\nimport { useSelector } from 'react-redux'\nimport { NO_OP } from '../../../data/types'\nimport { selectPreloadVideos } from '../../../redux/selectors'\nimport MediaProps from './MediaProps'\nimport { Overlay } from '../Overlay'\nimport { PostVideo } from './StyledMedia'\nimport { useAutoplay } from '../../../hooks/useAutoplay'\n\nexport default function Video(props: MediaProps) {\n  const { viewSrc, fullSrc, onLoad = NO_OP, index, width, height, detailsVisible, isFullscreen } = props\n\n  const [overlayVisible, setOverlayVisible] = React.useState(true)\n\n  // user play\n  const [userPlay, setUserPlay] = useState<boolean | null>(null)\n  const togglePlay: React.MouseEventHandler = React.useCallback(\n    (e) => {\n      e.stopPropagation()\n      setUserPlay(!userPlay)\n      setOverlayVisible(false)\n    },\n    [userPlay]\n  )\n\n  // auto play\n  const [videoRef, setVideoRef] = useState<HTMLVideoElement | null>(null)\n  const autoPlay = useAutoplay(videoRef)\n\n  const isPlaying = userPlay === undefined ? autoPlay : userPlay\n\n  const preload = useSelector(selectPreloadVideos) ? 'auto' : 'metadata'\n\n  React.useEffect(() => {\n    if (isPlaying && videoRef?.paused) {\n      videoRef?.play()\n    }\n\n    if (!isPlaying && !videoRef?.paused) {\n      videoRef?.pause()\n    }\n  }, [viewSrc, isPlaying, videoRef])\n\n  const handleSeek = React.useCallback(\n    (value: number) => {\n      if (videoRef) {\n        videoRef.currentTime = value\n      }\n    },\n    [videoRef]\n  )\n\n  return (\n    <>\n      <PostVideo\n        data-testid='video'\n        controls={false}\n        loop={!isFullscreen}\n        preload={preload}\n        ref={setVideoRef}\n        onLoadedMetadata={onLoad}\n        width={width}\n        height={height}\n        src={viewSrc}\n      />\n      <Overlay\n        type='video'\n        index={index}\n        fullSrc={fullSrc}\n        isPaused={!isPlaying}\n        duration={videoRef?.duration || 0}\n        onTogglePaused={togglePlay}\n        onSeek={handleSeek}\n        videoRef={videoRef}\n        isVisible={!isPlaying || detailsVisible || overlayVisible}\n        setVisible={setOverlayVisible}\n        isFullscreen={isFullscreen}\n      />\n    </>\n  )\n}\n","import * as r34 from 'r34-types'\r\nimport React from 'react'\r\nimport Picture from './media/Picture'\r\nimport Gif from './media/Gif'\r\nimport Video from './media/Video'\r\nimport { useSources } from '../../hooks/useSources'\r\n\r\ntype MediaProps = {\r\n  type: r34.PostType\r\n  index: number\r\n  thumbnailSrc: string\r\n  sampleSrc: string\r\n  fullSrc: string\r\n  onLoad: () => void\r\n  width: number\r\n  height: number\r\n  detailsVisible: boolean\r\n  isFullscreen?: boolean\r\n}\r\n\r\nexport function Media(props: MediaProps) {\r\n  const {\r\n    type,\r\n    thumbnailSrc,\r\n    sampleSrc,\r\n    fullSrc,\r\n    index,\r\n    onLoad,\r\n    width,\r\n    height,\r\n    detailsVisible,\r\n    isFullscreen = false,\r\n  } = props\r\n  const [preview, src] = useSources(type, thumbnailSrc, sampleSrc, fullSrc)\r\n\r\n  switch (type) {\r\n    case 'image':\r\n      return (\r\n        <Picture\r\n          viewSrc={src}\r\n          fullSrc={fullSrc}\r\n          onLoad={onLoad}\r\n          index={index}\r\n          width={width}\r\n          height={height}\r\n          isFullscreen={isFullscreen}\r\n        />\r\n      )\r\n    case 'gif':\r\n      return (\r\n        <Gif\r\n          detailsVisible={detailsVisible}\r\n          viewSrc={src}\r\n          thumbnailSrc={preview}\r\n          fullSrc={fullSrc}\r\n          onLoad={onLoad}\r\n          index={index}\r\n          width={width}\r\n          height={height}\r\n          isFullscreen={isFullscreen}\r\n        />\r\n      )\r\n    case 'video':\r\n      return (\r\n        <Video\r\n          detailsVisible={detailsVisible}\r\n          viewSrc={src}\r\n          thumbnailSrc={preview}\r\n          fullSrc={fullSrc}\r\n          onLoad={onLoad}\r\n          index={index}\r\n          width={width}\r\n          height={height}\r\n          isFullscreen={isFullscreen}\r\n        />\r\n      )\r\n  }\r\n}\r\n","import React from 'react'\r\nimport { useSelector } from 'react-redux'\r\nimport { selectOriginals } from '../redux/selectors'\r\nimport * as r34 from 'r34-types'\r\n\r\nexport function useSources(type: r34.PostType, thumbnailSrc: string, sampleSrc: string, fullSrc: string) {\r\n  const loadOriginals = useSelector(selectOriginals)\r\n\r\n  return React.useMemo(() => {\r\n    switch (type) {\r\n      case 'image':\r\n        return loadOriginals ? ['', fullSrc] : ['', sampleSrc]\r\n      case 'gif':\r\n        return sampleSrc.includes('.gif') ? [thumbnailSrc, sampleSrc] : [sampleSrc, fullSrc]\r\n      case 'video':\r\n        return loadOriginals ? [thumbnailSrc, fullSrc] : [thumbnailSrc, sampleSrc]\r\n    }\r\n  }, [fullSrc, loadOriginals, sampleSrc, thumbnailSrc, type])\r\n}\r\n","import React from 'react'\r\nimport { SourceIcon } from '../../../icons/FontAwesomeIcons'\r\nimport FlexPair from '../../designsystem/FlexPair'\r\nimport SourceProps from './SourceProps'\r\n\r\nexport default function FallbackSource({ value }: SourceProps) {\r\n  return (\r\n    <FlexPair data-testid='text-source'>\r\n      <SourceIcon color='white' />\r\n      <span>{value}</span>\r\n    </FlexPair>\r\n  )\r\n}\r\n","import styled, { css } from 'styled-components'\r\nimport { flexRowWithGap } from '../../styled/mixins'\r\n\r\nconst ColoredIconLink = styled.a(\r\n  ({ color, theme }) => css`\r\n    ${flexRowWithGap({ theme })}\r\n    ${color\r\n      ? css`\r\n          color: ${color} !important;\r\n        `\r\n      : ''};\r\n    white-space: nowrap;\r\n\r\n    svg {\r\n      height: 16px;\r\n    }\r\n  `\r\n)\r\n\r\nexport default ColoredIconLink\r\n","import React from 'react'\r\nimport { useTheme } from 'styled-components'\r\nimport { LinkIcon } from '../../../icons/FontAwesomeIcons'\r\nimport { formatSource } from '../../../misc/formatting'\r\nimport ColoredIconLink from '../../designsystem/ColoredIconLink'\r\nimport SourceProps from './SourceProps'\r\n\r\nexport default function DefaultLinkSource({ value }: SourceProps) {\r\n  const color = useTheme().colors.accentColor\r\n  const title = formatSource(value)\r\n\r\n  return (\r\n    <ColoredIconLink\r\n      data-testid='link-source'\r\n      color={color}\r\n      href={value}\r\n      target='_blank'\r\n      rel='noopener noreferrer'\r\n      className='source'\r\n    >\r\n      <LinkIcon color={color} />\r\n      {title}\r\n    </ColoredIconLink>\r\n  )\r\n}\r\n","import { DeviantArtIcon, DiscordIcon, PatreonIcon, TumblrIcon, TwitterIcon } from '../../../icons/FontAwesomeIcons'\r\nimport { PixivIcon } from '../../../icons/PixivIcon'\r\n\r\n/**\r\n * Cut away all the unnecessary parts of the link\r\n */\r\nexport function extractFirstElement(value: string) {\r\n  return value.split(' ')[0].split('?')[0].split('/')[0]\r\n}\r\n\r\nexport function extractSecondElement(value: string) {\r\n  return value.split(' ')[0].split('?')[0].split('/')[1]\r\n}\r\n\r\nexport type SourceMapping = [string, (props: any) => JSX.Element, (value: string) => string]\r\n\r\nexport const sources: Record<string, SourceMapping> = {\r\n  'twitter.com/': ['#1da1f2', TwitterIcon, (value) => extractFirstElement(value.split('twitter.com/')[1])],\r\n  'pixiv.net/': ['#0096FA', PixivIcon, () => 'Pixiv'],\r\n  'patreon.com/': [\r\n    '#FF424D',\r\n    PatreonIcon,\r\n    (value) => {\r\n      const path = value.split('patreon.com/')[1]\r\n\r\n      return path.startsWith('posts/') ? extractSecondElement(path) : extractFirstElement(path)\r\n    },\r\n  ],\r\n  'deviantart.com/': ['#00e59b', DeviantArtIcon, (value) => extractFirstElement(value.split('deviantart.com/')[1])],\r\n  'discordapp.com/': ['#7289DA', DiscordIcon, () => 'Discord'],\r\n  'tumblr.com': ['#75869C', TumblrIcon, (value) => new URL(value).hostname.split('.')[0]],\r\n}\r\n","import React, { SVGProps } from 'react'\n\nexport function PixivIcon(props: SVGProps<SVGElement>) {\n  return (\n    <svg viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>\n      <path\n        fill='currentColor'\n        d='M4.935 0A4.924 4.924 0 0 0 0 4.935v14.13A4.924 4.924 0 0 0 4.935 24h14.13A4.924 4.924 0 0 0 24 19.065V4.935A4.924 4.924 0 0 0 19.065 0zm7.81 4.547c2.181 0 4.058.676 5.399 1.847a6.118 6.118 0 0 1 2.116 4.66c.005 1.854-.88 3.476-2.257 4.563-1.375 1.092-3.225 1.697-5.258 1.697-2.314 0-4.46-.842-4.46-.842v2.718c.397.116 1.048.365.635.779H5.79c-.41-.41.19-.65.644-.779V7.666c-1.053.81-1.593 1.51-1.868 2.031.32 1.02-.284.969-.284.969l-1.09-1.73s3.868-4.39 9.553-4.39zm-.19.971c-1.423-.003-3.184.473-4.27 1.244v8.646c.988.487 2.484.832 4.26.832h.01c1.596 0 2.98-.593 3.93-1.533.952-.948 1.486-2.183 1.492-3.683-.005-1.54-.504-2.864-1.42-3.86-.918-.992-2.274-1.645-4.002-1.646Z'\n      />\n    </svg>\n  )\n}\n","import React from 'react'\r\nimport ColoredIconLink from '../../designsystem/ColoredIconLink'\r\n\r\ninterface SpecialLinkSourceProps {\r\n  value: string\r\n  color: string\r\n  Icon: (props: unknown) => JSX.Element\r\n  title: string\r\n}\r\n\r\nexport default function SpecialLinkSource(props: SpecialLinkSourceProps) {\r\n  const { value, color, Icon, title } = props\r\n  return (\r\n    <ColoredIconLink\r\n      data-testid='known-source'\r\n      href={value}\r\n      target='_blank'\r\n      rel='noopener noreferrer'\r\n      className='source'\r\n      color={color}\r\n    >\r\n      <Icon />\r\n      {title}\r\n    </ColoredIconLink>\r\n  )\r\n}\r\n","import React from 'react'\nimport { parseUrl } from '../../../data/utils'\nimport FallbackSource from './FallbackSource'\nimport DefaultLinkSource from './LinkSource'\nimport SourceProps from './SourceProps'\nimport { sources } from './sourceUtils'\nimport SpecialLinkSource from './SpecialLinkSource'\n\nexport default function Source({ value }: SourceProps) {\n  if (parseUrl(value)) {\n    // Sources can contain multiple links\n    const links = value.split(' ')\n    return (\n      <>\n        {links.map((link) => {\n          const source = Object.keys(sources).find((key) => link.includes(key))\n\n          if (source) {\n            const [color, Icon, getTitle] = sources[source]\n\n            return <SpecialLinkSource key={link} value={link} color={color} Icon={Icon} title={getTitle(link)} />\n          }\n\n          return <DefaultLinkSource key={link} value={link} />\n        })}\n      </>\n    )\n  }\n\n  return <FallbackSource value={value} />\n}\n","import styled from 'styled-components'\r\nimport { flexColumnWithGap, gutter } from '../../../styled/mixins'\r\n\r\nexport const AdditionalDetails = styled.div`\r\n  ${flexColumnWithGap}\r\n  ${gutter}\r\n  \r\n  flex-wrap: wrap;\r\n  padding-top: 0;\r\n  grid-row: 4/5;\r\n`\r\n","import * as r34 from 'r34-types'\r\nimport React from 'react'\r\nimport styled from 'styled-components'\r\nimport { flexColumnGap } from '../../../styled/mixins'\r\nimport { Faded } from '../../designsystem/Text'\r\nimport { AdditionalDetails } from './AdditonalDetails'\r\n\r\nconst Comment = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  ${flexColumnGap('4px')}\r\n`\r\n\r\nconst Username = styled.span`\r\n  line-height: 20px;\r\n`\r\n\r\nconst Message = styled(Faded)`\r\n  line-height: 20px;\r\n`\r\n\r\ninterface CommentsProps {\r\n  comments: r34.Comment[]\r\n}\r\n\r\nexport default function Comments(props: CommentsProps) {\r\n  const { comments } = props\r\n\r\n  return (\r\n    <AdditionalDetails>\r\n      {comments.map((comment, index) => (\r\n        <Comment key={index}>\r\n          <Username>{comment.creator}</Username>\r\n          <Message>{comment.body}</Message>\r\n        </Comment>\r\n      ))}\r\n    </AdditionalDetails>\r\n  )\r\n}\r\n","import React from 'react'\r\nimport styled from 'styled-components'\r\nimport { Post } from 'r34-types'\r\nimport { CalendarIcon, CheckIcon, ImageIcon, SourceIcon } from '../../../icons/FontAwesomeIcons'\r\nimport { formatDatetime, formatTime } from '../../../misc/formatting'\r\nimport FlexPair from '../../designsystem/FlexPair'\r\nimport { Faded } from '../../designsystem/Text'\r\nimport { AdditionalDetails } from './AdditonalDetails'\r\n\r\nconst Entry = styled(Faded)`\r\n  white-space: nowrap;\r\n`\r\n\r\ntype MetadataProps = Pick<Post, 'created_at' | 'status' | 'width' | 'height' | 'id'>\r\n\r\nexport default function Metadata(props: MetadataProps) {\r\n  const { created_at, width, height, id, status } = props\r\n\r\n  const createdAt = new Date(created_at)\r\n\r\n  return (\r\n    <AdditionalDetails>\r\n      <FlexPair title='Id'>\r\n        <SourceIcon />\r\n        <Entry data-testid='id'>{id}</Entry>\r\n      </FlexPair>\r\n\r\n      <FlexPair title='Upload Date'>\r\n        <CalendarIcon />\r\n        <Entry data-testid='date'>\r\n          {formatDatetime(createdAt)} ({formatTime(Date.now() - createdAt.getTime())} ago)\r\n        </Entry>\r\n      </FlexPair>\r\n\r\n      <FlexPair title='Status'>\r\n        <CheckIcon />\r\n        <Entry data-testid='status'>{status}</Entry>\r\n      </FlexPair>\r\n\r\n      <FlexPair title='Measurements'>\r\n        <ImageIcon />\r\n        <Entry data-testid='size'>\r\n          {width} x {height}\r\n        </Entry>\r\n      </FlexPair>\r\n    </AdditionalDetails>\r\n  )\r\n}\r\n","import React from 'react'\nimport * as r34 from 'r34-types'\nimport { RatingIcon } from '../../../icons/FontAwesomeIcons'\nimport FlexPair from '../../designsystem/FlexPair'\nimport { useTheme } from 'styled-components'\n\nconst fullnames: Record<r34.PostRating, string> = {\n  e: 'Explicit',\n  q: 'Questionable',\n  s: 'Safe',\n}\n\ninterface RatingProps {\n  value: r34.PostRating\n}\n\nexport default function Rating(props: RatingProps) {\n  const { value } = props\n  const theme = useTheme()\n\n  return (\n    <FlexPair data-testid='rating' title={fullnames[value]}>\n      <RatingIcon color={theme.colors.text} />\n      <span>{value.toUpperCase()}</span>\n    </FlexPair>\n  )\n}\n","import React, { MouseEventHandler, useCallback } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport styled, { css, DefaultTheme } from 'styled-components'\nimport { boolToNumber } from '../../../data/utils'\nimport { HeartIcon } from '../../../icons/FontAwesomeIcons'\nimport { formatCount } from '../../../misc/formatting'\nimport { likePost } from '../../../redux/actions'\nimport { selectLikedByPostId } from '../../../redux/selectors'\nimport FlexPair from '../../designsystem/FlexPair'\n\nconst ScorePair = styled(FlexPair)(\n  ({ $liked, theme }: { $liked: boolean; theme: DefaultTheme }) => css`\n    transition: transform 0.1s ease-out;\n    cursor: pointer;\n\n    ${$liked\n      ? css`\n          color: ${theme.colors.liked};\n\n          svg {\n            color: ${theme.colors.liked};\n          }\n        `\n      : css``}\n\n    :active {\n      transform: scale(1.1);\n    }\n  `\n)\n\nexport default function Score(props: { value: number; postId: number }) {\n  const { value, postId } = props\n\n  const dispatch = useDispatch()\n\n  const liked = useSelector(selectLikedByPostId(postId))\n  const handleClick: MouseEventHandler = useCallback(\n    (event) => {\n      event.stopPropagation()\n\n      if (!liked) {\n        dispatch(likePost(postId))\n      }\n    },\n    [dispatch, liked, postId]\n  )\n\n  return (\n    <ScorePair onClick={handleClick} $liked={liked} data-testid='score'>\n      <HeartIcon color='white' />\n      <span>{formatCount(value + boolToNumber(liked))}</span>\n    </ScorePair>\n  )\n}\n","import React, { MouseEventHandler, useCallback, useEffect, useMemo } from 'react'\nimport { useSelector } from 'react-redux'\nimport styled, { css, DefaultTheme } from 'styled-components'\nimport * as r34 from 'r34-types'\nimport { ActiveTab, NO_OP } from '../../../data/types'\nimport { listToMap } from '../../../data/utils'\nimport useToggleTag from '../../../hooks/useToggleTag'\nimport { selectPostById, selectShowComments, selectShowMetadata } from '../../../redux/selectors'\nimport { flexRowGap, flexRowWithGap, gutter, layer } from '../../../styled/mixins'\nimport TagList from '../../tag/TagList'\nimport Source from '../source/Source'\nimport Comments from './Comments'\nimport Metadata from './Metadata'\nimport Rating from './Rating'\nimport Score from './Score'\nimport { useCheckIsActive } from '../../../hooks/useCheckIsActive'\n\nconst Bar = styled.div(\n  ({ theme }) => css`\n    grid-row: 2/3;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    flex-wrap: nowrap;\n    overflow-x: auto;\n    ${layer({ theme })}\n    padding: ${theme.dimensions.gutter};\n    ${flexRowGap(theme.dimensions.hugeSpacing)}\n    border-radius: 0 0 ${theme.dimensions.borderRadius} ${theme.dimensions.borderRadius};\n  `\n)\n\nconst Menu = styled.div`\n  ${flexRowWithGap}\n  ${gutter}\n  justify-content: space-around;\n  margin-top: 8px;\n  grid-row: 3/4;\n`\n\nconst MenuEntry = styled.span`\n  cursor: pointer;\n\n  ${({ active, theme }: { active: boolean; theme: DefaultTheme }) =>\n    active\n      ? css`\n          color: ${theme.colors.accentColor};\n        `\n      : ''}\n`\n\nconst DetailsTagList = styled(TagList)(\n  ({ theme }) => css`\n    grid-row: 4/5;\n    padding: ${theme.dimensions.gutter};\n  `\n)\n\ninterface DetailsProps {\n  postId: number\n  onLoad?: () => void\n  activeTab: ActiveTab\n  setActiveTab: React.Dispatch<React.SetStateAction<ActiveTab>>\n  hasComments: boolean\n}\n\nexport default function Details(props: DetailsProps) {\n  const { postId, onLoad = NO_OP, activeTab, setActiveTab, hasComments } = props\n  const { rating, score, tags, source, created_at, status, height, width, comments } = useSelector(\n    selectPostById(postId)\n  ) as r34.Post\n  const tagsForRendering = useMemo(\n    () =>\n      listToMap(\n        tags.map((tag) => ({ name: tag, types: [] })),\n        'name'\n      ),\n    [tags]\n  )\n  const showMetadata = useSelector(selectShowMetadata)\n  const showComments = useSelector(selectShowComments)\n\n  const checkIsActive = useCheckIsActive()\n\n  const commentsLength = comments?.length || 0\n\n  const toggleTag = useToggleTag()\n  const setTags: MouseEventHandler = useCallback(\n    (event) => {\n      event.stopPropagation()\n      setActiveTab('tags')\n    },\n    [setActiveTab]\n  )\n\n  const setComments: MouseEventHandler = useCallback(\n    (event) => {\n      event.stopPropagation()\n      setActiveTab('comments')\n    },\n    [setActiveTab]\n  )\n\n  const setMetadata: MouseEventHandler = useCallback(\n    (event) => {\n      event.stopPropagation()\n      setActiveTab('metadata')\n    },\n    [setActiveTab]\n  )\n\n  useEffect(() => {\n    onLoad()\n  }, [onLoad, activeTab])\n\n  return (\n    <>\n      <Bar>\n        <Rating value={rating} />\n        <Score value={score} postId={postId} />\n        {!!source && <Source value={source} />}\n      </Bar>\n      {((showComments && commentsLength > 0) || showMetadata) && (\n        <Menu>\n          <MenuEntry active={activeTab === 'tags'} onClick={setTags}>\n            Tags\n          </MenuEntry>\n          {showComments && hasComments && (\n            <MenuEntry active={activeTab === 'comments'} onClick={setComments}>\n              Comments\n            </MenuEntry>\n          )}\n          {showMetadata && (\n            <MenuEntry active={activeTab === 'metadata'} onClick={setMetadata}>\n              Metadata\n            </MenuEntry>\n          )}\n        </Menu>\n      )}\n\n      {\n        {\n          tags: (\n            <DetailsTagList\n              tags={tagsForRendering}\n              detailed={false}\n              onTagClick={toggleTag}\n              getIsActive={checkIsActive}\n            />\n          ),\n          comments: <Comments comments={comments as r34.Comment[]} />,\n          metadata: <Metadata created_at={created_at} status={status} width={width} height={height} id={postId} />,\n        }[activeTab]\n      }\n    </>\n  )\n}\n","import * as r34 from 'r34-types'\nimport React from 'react'\nimport { useEffect, useState } from 'react'\nimport { useDispatch, useSelector } from 'react-redux'\nimport styled, { css } from 'styled-components'\nimport { ActiveTab, NO_OP } from '../../data/types'\nimport useToggle from '../../hooks/useToggle'\nimport { fetchComments } from '../../redux/actions'\nimport { selectShowComments } from '../../redux/selectors'\nimport { layer } from '../../styled/mixins'\nimport LayoutElementProps from '../layout/LayoutElementProps'\nimport { Media } from '../player/Media'\nimport Details from './details/Details'\n\nconst ItemWrapper = styled.div(\n  ({ theme }) => css`\n    padding-top: ${theme.dimensions.gutter};\n  `\n)\n\nconst PositonWrapper = styled.div(\n  ({ theme }) => css`\n    padding: 0 ${theme.dimensions.gutter};\n    width: 100%;\n    max-width: ${theme.dimensions.bodyWidth};\n    margin: auto;\n  `\n)\n\nconst PostWrapper = styled.div(\n  ({ theme }) => css`\n    display: grid;\n    grid-template-columns: 1fr;\n    grid-template-rows: auto auto auto auto;\n    border-radius: ${theme.dimensions.borderRadius};\n    ${layer({ theme })}\n  `\n)\n\nexport function ListPost(props: r34.Post & LayoutElementProps & { index: number }) {\n  const {\n    style,\n    virtualRef,\n    type,\n    sample_url,\n    file_url,\n    preview_url,\n    onLoad = NO_OP,\n    id,\n    width,\n    height,\n    comments,\n    has_comments,\n    index,\n  } = props\n\n  return (\n    <ItemWrapper style={style} ref={virtualRef} className='list-div'>\n      <PositonWrapper>\n        <Post\n          type={type}\n          sample_url={sample_url}\n          file_url={file_url}\n          preview_url={preview_url}\n          onLoad={onLoad}\n          id={id}\n          width={width}\n          height={height}\n          comments={comments}\n          has_comments={has_comments}\n          index={index}\n        />\n      </PositonWrapper>\n    </ItemWrapper>\n  )\n}\n\ntype PostProps = Pick<\n  r34.Post,\n  'type' | 'sample_url' | 'file_url' | 'preview_url' | 'id' | 'width' | 'height' | 'comments' | 'has_comments'\n> & { onLoad?: () => void; index: number }\n\nexport const Post = React.memo((props: PostProps) => {\n  const {\n    type,\n    sample_url,\n    file_url,\n    preview_url,\n    onLoad = NO_OP,\n    id,\n    width,\n    height,\n    comments,\n    has_comments,\n    index,\n  } = props\n\n  const dispatch = useDispatch()\n\n  const [activeTab, setActiveTab] = useState<ActiveTab>('tags')\n  const [collapsed, toggleCollapsed] = useToggle(true)\n\n  const showComments = useSelector(selectShowComments)\n\n  // re-measure when collapsed state changes\n  useEffect(() => {\n    onLoad()\n  }, [onLoad, collapsed])\n\n  // Loads comments if conditions are met\n  useEffect(() => {\n    if (!collapsed && showComments && has_comments && !comments) {\n      dispatch(fetchComments(id))\n    }\n  }, [collapsed, showComments, has_comments, comments, dispatch, id])\n\n  return (\n    <PostWrapper onClick={toggleCollapsed} role='row'>\n      <Media\n        detailsVisible={!collapsed}\n        type={type}\n        thumbnailSrc={preview_url}\n        sampleSrc={sample_url}\n        fullSrc={file_url}\n        onLoad={onLoad}\n        index={index}\n        width={width}\n        height={height}\n      />\n      {!collapsed && (\n        <Details\n          postId={id}\n          onLoad={onLoad}\n          activeTab={activeTab}\n          setActiveTab={setActiveTab}\n          hasComments={has_comments}\n        />\n      )}\n    </PostWrapper>\n  )\n})\n","import styled, { css, DefaultTheme } from 'styled-components'\r\nimport { borderRadius } from '../../styled/mixins'\r\n\r\nexport const SubtleInput = styled.input(\r\n  (props: { value: string; theme: DefaultTheme }) => css`\r\n    background: ${props.theme.colors.backgroundColor};\r\n    padding: ${props.theme.dimensions.spacing};\r\n    ${borderRadius}\r\n    border: none;\r\n    outline: none;\r\n    color: ${props.theme.colors.accentColor};\r\n    width: 3.4rem;\r\n    text-align: right;\r\n    font-size: ${props.theme.fontSizes.content};\r\n\r\n    ::-webkit-inner-spin-button,\r\n    ::-webkit-outer-spin-button {\r\n      -webkit-appearance: none;\r\n      margin: 0;\r\n    }\r\n    -moz-appearance: textfield;\r\n  `\r\n)\r\n","import { ChangeEventHandler, useCallback, useState } from 'react'\nimport styled from 'styled-components'\nimport LabeledToggle from '../designsystem/LabeledToggle'\nimport { PostsSort } from 'r34-types'\nimport usePreference from '../../hooks/usePreference'\nimport { flexRowWithGap, gridWithGap, PropsWithTheme } from '../../styled/mixins'\nimport Select from '../designsystem/Select'\nimport { SubtleInput } from '../designsystem/SubtleInput'\n\nconst OptionsWrapper = styled.div`\n  ${gridWithGap}\n`\n\nconst RatedRow = styled.div`\n  ${flexRowWithGap}\n`\n\nconst SortRow = styled.div`\n  ${flexRowWithGap}\n  height: ${({ theme }: PropsWithTheme) => theme.dimensions.blockHeight};\n`\n\nconst sortOptions: Record<PostsSort, string> = {\n  score: 'Score',\n  date: 'Date',\n}\n\nexport default function Options() {\n  const [rated, setRated] = usePreference('rated')\n  const [ratedThreshold, setRatedThreshold] = usePreference('ratedThreshold')\n  const [sort, setSort] = usePreference('sort')\n\n  const toggleRated = useCallback(() => setRated(!rated), [rated, setRated])\n\n  const [ratedThresholdInternal, setRatedThresholdInternal] = useState(ratedThreshold ? ratedThreshold.toString() : '1')\n\n  const onChange: ChangeEventHandler<HTMLInputElement> = useCallback(\n    (event) => setRatedThresholdInternal(event.target.value),\n    []\n  )\n  const onBlur = useCallback(\n    () => setRatedThreshold(Number(ratedThresholdInternal)),\n    [ratedThresholdInternal, setRatedThreshold]\n  )\n\n  const handleSubmit = useCallback((e) => {\n    if (e.key === 'Enter') e.target.blur()\n  }, [])\n\n  const handleSortChange: ChangeEventHandler<HTMLSelectElement> = useCallback(\n    (event) => setSort(event.target.value as PostsSort),\n    [setSort]\n  )\n\n  return (\n    <OptionsWrapper data-testid='options-wrapper'>\n      <LabeledToggle value={rated} onToggle={toggleRated}>\n        {rated ? (\n          <RatedRow>\n            <span>More than</span>\n            <SubtleInput\n              type='number'\n              value={ratedThresholdInternal}\n              onChange={onChange}\n              onBlur={onBlur}\n              onKeyDown={handleSubmit}\n            />\n            <span>likes</span>\n          </RatedRow>\n        ) : (\n          'Only show popular posts'\n        )}\n      </LabeledToggle>\n      <SortRow>\n        <span>Sort by:</span>\n        <Select options={sortOptions} value={sort} onChange={handleSortChange} />\n      </SortRow>\n    </OptionsWrapper>\n  )\n}\n","import React from 'react'\nimport useAction from '../../hooks/useAction'\nimport { SearchIcon } from '../../icons/FontAwesomeIcons'\nimport { getResults, openModal } from '../../redux/actions'\nimport { BlockButton } from '../designsystem/Buttons'\nimport { useHistory } from 'react-router-dom'\nimport { ModalId, RouteName } from '../../data/types'\nimport { useConnectionState } from '../../hooks/useConnectionState'\nimport { selectAutoPlay, selectOriginals, selectPreloadVideos } from '../../redux/selectors'\nimport { useDispatch, useSelector } from 'react-redux'\n\nlet isUserNotified = false\n\nexport default function SearchButton() {\n  const search = useAction(getResults)\n  const dispatch = useDispatch()\n\n  const history = useHistory()\n  const connection = useConnectionState()\n  const preloadVideos = useSelector(selectPreloadVideos)\n  const autoplay = useSelector(selectAutoPlay)\n  const originals = useSelector(selectOriginals)\n\n  const handleClick = React.useCallback(() => {\n    const riskyFeatureEnabled = preloadVideos || autoplay || originals\n\n    if (!isUserNotified && connection === 'cellular' && riskyFeatureEnabled) {\n      dispatch(openModal(ModalId.CELLULAR_WARNING))\n      isUserNotified = true\n    } else {\n      search()\n      history.push({ pathname: RouteName.SEARCH, hash: 'results' })\n    }\n  }, [autoplay, connection, dispatch, history, originals, preloadVideos, search])\n\n  return (\n    <BlockButton onClick={handleClick} aria-label='Search'>\n      <SearchIcon />\n      Search\n    </BlockButton>\n  )\n}\n","import { useState, useEffect } from 'react'\r\n\r\nexport function useConnectionState() {\r\n  //@ts-expect-error\r\n  const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection\r\n\r\n  const [connectionState, setConnectionState] = useState<string | undefined>(connection?.type)\r\n\r\n  useEffect(() => {\r\n    const listener = () => setConnectionState(connection.type)\r\n    connection.addEventListener('change', listener, { passive: true })\r\n    return () => connection.removeEventListener('change', listener)\r\n  }, [connection])\r\n\r\n  return connectionState as\r\n    | 'bluetooth'\r\n    | 'cellular'\r\n    | 'ethernet'\r\n    | 'none'\r\n    | 'wifi'\r\n    | 'wimax'\r\n    | 'other'\r\n    | 'unknown'\r\n    | undefined\r\n}\r\n","import styled from 'styled-components'\nimport TagSelector from '../tagSelector/TagSelector'\nimport Options from './Options'\nimport { Title } from '../designsystem/Text'\nimport Surface from '../designsystem/Surface'\nimport SearchButton from '../widgets/SearchButton'\nimport ActiveTags from '../widgets/ActiveTags'\nimport { flexColumn, gutter, centeredMaxWidth } from '../../styled/mixins'\nimport useFirebaseAuthState from '../../hooks/useFirebaseAuthState'\nimport { useActivateTag } from '../../hooks/useActivateTag'\n\nconst ConfigWrapper = styled.section`\n  ${flexColumn}\n  ${gutter}\n  ${centeredMaxWidth}\n`\n\nexport default function Config(props: { onLoad: () => void }) {\n  const { onLoad } = props\n\n  const [isSignedIn] = useFirebaseAuthState()\n  const activateTag = useActivateTag()\n\n  return (\n    <ConfigWrapper>\n      <Title>\n        <label htmlFor='tag-input'>Search</label>\n      </Title>\n      <Surface>\n        <TagSelector onSubmit={activateTag} showSupertags />\n        <ActiveTags onChange={onLoad} offerSupertags={isSignedIn} />\n        <Options />\n        <SearchButton />\n      </Surface>\n    </ConfigWrapper>\n  )\n}\n","import React, { useCallback, useState } from 'react'\nimport styled, { css } from 'styled-components'\nimport { Faded } from '../designsystem/Text'\n\nconst tips = [\n  'Try tapping the little plus in the tag search.',\n  \"You can exclude tags with the '-' modifier.\",\n  \"Each result will have at least one of your '~' tags.\",\n  'Check out the settings. There are lots of useful options there.',\n  'You can get more info about a post be tapping it once.',\n  'Tapping on a tag below a post adds it to your active tags.',\n  \"Large gifs and videos can take a while to load in the app. Try clicking the 'Open in new tab' icon in the bottom left corner for faster loading times.\",\n  'If anything stops working or gets weird. Reset the app in the settings.',\n  'I hope you are having a nice day!',\n  'If a tag is ambiguous, it will have a little arrow on the right. Tapping it shows related tags.',\n  'Tapping the icon in the top left of posts brings you into fullscreen mode.',\n  'Searching for nothing returns ALL posts ever made.',\n  'Results are sorted chronologically. Newest first.',\n  \"You can search for safe posts by entering 'rating:safe' in the search field. The same works for questionable and explicit.\",\n  \"You can search for posts from a specific website by entering 'source:*twitter* for example.\",\n  'You can upvote a post by tapping its score in the details.',\n  'Wanna know more about a post? Enable \"Show post metadata\" in the options.',\n  'Every time you load this page, a random tip will be shown here.',\n  'You can enable comments in the settings. Not all post have comments though.',\n  'You can save and share your settings across devices if you log in with your Google account.',\n  'Tapping the number of results displays the exact number instead of an approximation.',\n  'You can create supertags once you have two or more active tags.',\n  'Supertags are collections of tags that you can add together.',\n  'Supertags retain the modifiers of the tags they contain.',\n  'You can tap this tip to get another one.',\n]\n\nconst Span = styled(Faded)(\n  ({ theme }) => css`\n    text-align: center;\n    font-size: 16px;\n    padding: ${theme.dimensions.hugeSpacing} 10%;\n    max-width: ${theme.dimensions.bodyWidth};\n  `\n)\n\nfunction getRandomTip() {\n  return tips[Math.floor(Math.random() * tips.length)]\n}\n\nexport default function RandomTip() {\n  const [tip, setTip] = useState(getRandomTip())\n  const nextTip = useCallback(() => {\n    setTip(getRandomTip())\n  }, [])\n\n  return <Span onClick={nextTip}>{tip}</Span>\n}\n","import React from 'react'\r\nimport styled, { css } from 'styled-components'\r\nimport { WrenchIcon } from '../../icons/FontAwesomeIcons'\r\nimport { borderRadius, flexColumnWithGap, layer } from '../../styled/mixins'\r\nimport FlexPair from '../designsystem/FlexPair'\r\nimport { SmallTitle } from '../designsystem/Text'\r\n\r\nconst Wrapper = styled(FlexPair)(\r\n  ({ theme }) => css`\r\n    ${borderRadius}\r\n    ${layer}\r\n    width: 100%;\r\n    padding: ${theme.dimensions.hugeSpacing};\r\n    max-width: ${theme.dimensions.bodyWidth};\r\n  `\r\n)\r\n\r\nconst Message = styled.div`\r\n  ${flexColumnWithGap}\r\n`\r\n\r\nconst deadline = new Date('13-08-2021')\r\n\r\nexport default function UpdateHighlight() {\r\n  if (new Date() > deadline) {\r\n    return null\r\n  }\r\n\r\n  return (\r\n    <Wrapper>\r\n      <Message>\r\n        <FlexPair>\r\n          <WrenchIcon size={'lg'} />\r\n          <SmallTitle>Update News</SmallTitle>\r\n        </FlexPair>\r\n        <p>I am currently working on the fullscreen view. Things might not work that well over there.</p>\r\n      </Message>\r\n    </Wrapper>\r\n  )\r\n}\r\n","import React from 'react'\r\nimport KofiButton from './KofiButton'\r\nimport styled, { css } from 'styled-components'\r\nimport RandomTip from './RandomTip'\r\nimport { flexColumnWithGap } from '../../styled/mixins'\r\nimport UpdateHighlight from './UpdateHighlight'\r\n\r\nconst Placeholder = styled.div(\r\n  ({ theme }) => css`\r\n    ${flexColumnWithGap}\r\n    align-items: center;\r\n    max-width: ${theme.dimensions.bodyWidth};\r\n    margin: auto;\r\n\r\n    padding: 0 ${theme.dimensions.gutter};\r\n  `\r\n)\r\n\r\nexport default function SearchPlaceholder() {\r\n  return (\r\n    <Placeholder>\r\n      <UpdateHighlight />\r\n      <RandomTip />\r\n      <KofiButton id='V7V73PWW9' label='Support Me on Ko-fi' />\r\n    </Placeholder>\r\n  )\r\n}\r\n","import React from 'react'\r\nimport styled from 'styled-components'\r\nimport { useSelector } from 'react-redux'\r\nimport useToggle from '../../hooks/useToggle'\r\nimport { formatCount } from '../../misc/formatting'\r\nimport { selectCount } from '../../redux/selectors'\r\nimport { Title } from '../designsystem/Text'\r\n\r\nconst ClickableTitle = styled(Title)`\r\n  cursor: pointer;\r\n`\r\n\r\nexport default function ResultsTitle() {\r\n  const [fullNumber, toggleFullNumber] = useToggle()\r\n  const count = useSelector(selectCount)\r\n\r\n  const formattedCount = fullNumber ? count.toLocaleString() : formatCount(count)\r\n\r\n  return (\r\n    <ClickableTitle id='results' onClick={toggleFullNumber}>\r\n      {formattedCount} results\r\n    </ClickableTitle>\r\n  )\r\n}\r\n","import React, { useEffect } from 'react'\nimport { useSelector } from 'react-redux'\nimport { selectCount } from '../../redux/selectors'\nimport Config from '../features/Config'\nimport Header from '../features/Header'\nimport LayoutElementProps from './LayoutElementProps'\nimport { NO_OP } from '../../data/types'\nimport SearchPlaceholder from '../widgets/SearchPlaceholder'\nimport ResultsTitle from '../widgets/ResultsTitle'\n\nexport default function LayoutHeader({ onLoad = NO_OP, virtualRef, style }: LayoutElementProps) {\n  const count = useSelector(selectCount)\n\n  // Trigger load event when count is > 0\n  // This is used to re-measure the element\n  useEffect(() => {\n    count > 0 && onLoad()\n  }, [count, onLoad])\n\n  return (\n    <div onLoad={onLoad} ref={virtualRef} style={style} role='row'>\n      <Header />\n      <Config onLoad={onLoad} />\n      {count > 0 ? <ResultsTitle /> : <SearchPlaceholder />}\n    </div>\n  )\n}\n","import React, { useMemo } from 'react'\nimport Surface from '../designsystem/Surface'\nimport { SmallTitle } from '../designsystem/Text'\nimport TagList from '../tag/TagList'\nimport outOfResultsPicture from '../../icons/OutOfResults.png'\nimport { useSelector } from 'react-redux'\nimport { selectAliasesAsList } from '../../redux/selectors'\nimport { NO_OP } from '../../data/types'\nimport LayoutElementProps from './LayoutElementProps'\nimport { HorizontalLine } from '../designsystem/Lines'\nimport styled, { css } from 'styled-components'\nimport FlexImage from '../designsystem/FlexImage'\nimport useToggleTag from '../../hooks/useToggleTag'\nimport * as r34 from 'r34-types'\n\nconst Div = styled.div(\n  ({ theme }) => css`\n    padding: ${theme.dimensions.gutter};\n  `\n)\n\nconst StyledSurface = styled(Surface)(\n  ({ theme }) => css`\n    max-width: ${theme.dimensions.bodyWidth};\n    margin: auto;\n    text-align: center;\n  `\n)\n\nconst StyledImage = styled(FlexImage)`\n  max-height: 50vh;\n`\n\nexport default function LayoutOutOfItems({ onLoad = NO_OP, virtualRef, style }: LayoutElementProps) {\n  const aliases = useSelector(selectAliasesAsList)\n  const aliasesForRendering = useMemo(\n    () =>\n      aliases.reduce((result, alias) => {\n        result[alias.name] = { ...alias, types: [] }\n        return result\n      }, {} as Record<string, r34.Tag>),\n    [aliases]\n  )\n  const toggleTag = useToggleTag()\n\n  return (\n    <Div style={style} ref={virtualRef} onLoad={onLoad} role='row'>\n      <StyledSurface>\n        <StyledImage src={outOfResultsPicture} alt='Shironeko does not understand' />\n        <HorizontalLine />\n        <SmallTitle>You have reached the end!</SmallTitle>\n        <p>Go look for something else!</p>\n        {aliases.length > 0 && (\n          <>\n            <p>How about some of these?</p>\n            <TagList tags={aliasesForRendering} onTagClick={toggleTag} detailed />\n          </>\n        )}\n      </StyledSurface>\n    </Div>\n  )\n}\n","import React from 'react'\nimport LayoutElementProps from './LayoutElementProps'\nimport LoadingIcon from '../../icons/Loading'\nimport styled from 'styled-components'\nimport { NO_OP } from '../../data/types'\n\nconst Wrapper = styled.div`\n  display: grid;\n  place-items: center;\n`\n\nexport default function LayoutLoadingItem({ onLoad = NO_OP, virtualRef, style }: LayoutElementProps) {\n  return (\n    <Wrapper onLoad={onLoad} ref={virtualRef} style={style} role='row'>\n      <LoadingIcon />\n    </Wrapper>\n  )\n}\n","import React, { MouseEventHandler, useCallback } from 'react'\nimport { useSelector } from 'react-redux'\nimport styled, { css } from 'styled-components'\nimport { selectLastPage } from '../../../redux/selectors'\nimport { RedButton } from '../../designsystem/Buttons'\nimport { SmallNumberInput } from '../../designsystem/SmallInput'\n\nconst PageRow = styled.div(\n  ({ theme }) => css`\n    display: grid;\n    grid-template-columns: 1fr auto 1fr;\n    justify-content: center;\n    place-items: center;\n    gap: ${theme.dimensions.gutter};\n    padding: ${theme.dimensions.gutter};\n    padding-bottom: 0;\n    max-width: ${theme.dimensions.bodyWidth};\n    margin: auto;\n  `\n)\nconst Left = styled.div`\n  display: flex;\n  place-self: flex-end;\n  gap: 8px;\n`\nconst Right = styled.div`\n  display: flex;\n  place-self: flex-start;\n  gap: 8px;\n`\n\nconst PageNumber = styled(RedButton)`\n  min-width: 50px;\n`\n\nconst CurrentNumber = styled(SmallNumberInput)`\n  min-width: 50px;\n`\n\ninterface PageNavigationProps {\n  currentPage: number\n  loadPage: (pageNumber: number) => void\n}\n\nexport default function PageNavigation(props: PageNavigationProps) {\n  const { currentPage, loadPage } = props\n\n  const lastPage = useSelector(selectLastPage)\n\n  const loadSpecificPage = useCallback((newPage: number | string) => loadPage(Number(newPage)), [loadPage])\n  const loadFirst: MouseEventHandler<HTMLButtonElement> = useCallback(() => loadPage(0), [loadPage])\n  const loadLast: MouseEventHandler<HTMLButtonElement> = useCallback(() => loadPage(lastPage), [loadPage, lastPage])\n  const loadPrevious: MouseEventHandler<HTMLButtonElement> = useCallback(\n    () => loadPage(currentPage - 1),\n    [currentPage, loadPage]\n  )\n  const loadNext: MouseEventHandler<HTMLButtonElement> = useCallback(\n    () => loadPage(currentPage + 1),\n    [currentPage, loadPage]\n  )\n\n  // Render Empty divs to keep everything lined up\n  // Could achive the same with grid-column (might do that in the future)\n  return (\n    <PageRow className='page-navigation'>\n      <Left>\n        {currentPage > 1 && <PageNumber onClick={loadFirst}>0</PageNumber>}\n        {currentPage > 0 && <PageNumber onClick={loadPrevious}>{currentPage - 1}</PageNumber>}\n      </Left>\n      <CurrentNumber value={currentPage} onSubmit={loadSpecificPage} />\n      <Right>\n        {currentPage < lastPage && <PageNumber onClick={loadNext}>{currentPage + 1}</PageNumber>}\n        {currentPage < lastPage - 1 && <PageNumber onClick={loadLast}>{lastPage}</PageNumber>}\n      </Right>\n    </PageRow>\n  )\n}\n","import React, { ReactNode, useCallback } from 'react'\nimport styled, { css } from 'styled-components'\nimport { Post } from 'r34-types'\nimport BaseFlexColumn from '../../designsystem/FlexColumn'\nimport PageNavigation from './PageNavigation'\n\nconst FlexColumn = styled(BaseFlexColumn)(\n  ({ theme }) => css`\n    padding-bottom: ${theme.dimensions.gutter};\n  `\n)\n\ninterface PageLayoutProps<T> {\n  header?: ReactNode\n  outOfItems?: ReactNode\n  items?: T[]\n  pageSize: number\n  currentPage: number\n  hasMorePages: boolean\n  loadPage: (pageNumber: number) => void\n  ItemComponent: (props: T & { index: number }) => JSX.Element\n  isLoading: boolean\n  setLoading: (value: boolean) => void\n}\n\nexport default function PageLayout(props: PageLayoutProps<Post>) {\n  const { header, items, ItemComponent, currentPage, loadPage } = props\n\n  const scrollAndLoadPage = useCallback(\n    (value: number) => {\n      loadPage(value)\n      document.getElementsByClassName('page-navigation')[0].scrollIntoView()\n    },\n    [loadPage]\n  )\n\n  return (\n    <FlexColumn>\n      {header}\n      {items && items.length > 0 && (\n        <>\n          <PageNavigation currentPage={currentPage} loadPage={loadPage} />\n          {items?.map((item, index) => (\n            <ItemComponent key={item.id} index={index} {...item} />\n          ))}\n          <PageNavigation currentPage={currentPage} loadPage={scrollAndLoadPage} />\n        </>\n      )}\n    </FlexColumn>\n  )\n}\n","import React, { useEffect, useState } from 'react'\nimport { useSelector } from 'react-redux'\nimport styled, { css } from 'styled-components'\nimport useThrottledEffect from 'use-throttled-effect'\nimport { openFullscreen } from '../../data/browserUtils'\nimport { ActiveTab, NO_OP } from '../../data/types'\nimport useAction from '../../hooks/useAction'\nimport useFullScreenCloseEffect from '../../hooks/useFullscreenCloseEffect'\nimport { exitFullscreen, getMoreResults } from '../../redux/actions'\nimport { selectFullsceenState, selectFullScreenIndex, selectFullScreenPost, selectPosts } from '../../redux/selectors'\nimport { Media } from '../player/Media'\nimport Details from '../post/details/Details'\n\nconst FullScreenDiv = styled.div(\n  ({ theme }) => css`\n    position: fixed;\n    width: 100vw;\n    height: 200vh;\n    left: 0;\n    top: 0;\n\n    display: grid;\n    grid-template-columns: 100vw;\n    grid-template-rows: 100vh 40px auto;\n    overflow: auto;\n\n    background: ${theme.colors.backgroundColor};\n\n    z-index: 5;\n\n    scroll-snap-type: y mandatory;\n    //scroll-snap-points-y: 0vh 100vh;\n\n    > * {\n      scroll-snap-align: start;\n    }\n\n    ::-webkit-scrollbar {\n      width: 0px;\n    }\n  `\n)\n\nexport default function Reader() {\n  const posts = useSelector(selectPosts)\n  const isReaderOpen = useSelector(selectFullsceenState)\n  const index = useSelector(selectFullScreenIndex)\n  const fullScreenPost = useSelector(selectFullScreenPost)\n  const fullScreenIndex = useSelector(selectFullScreenIndex)\n\n  const loadMore = useAction(getMoreResults)\n\n  const [readerRef, setReaderRef] = useState<HTMLDivElement | null>(null)\n\n  useThrottledEffect(\n    () => {\n      if (fullScreenIndex + 3 > posts.length) {\n        loadMore()\n      }\n    },\n    2000,\n    [fullScreenIndex, loadMore, posts.length]\n  )\n\n  useEffect(() => {\n    if (isReaderOpen && readerRef && readerRef !== document.fullscreenElement) {\n      openFullscreen(readerRef)\n    }\n  }, [isReaderOpen, readerRef])\n\n  const [activeTab, setActiveTab] = useState<ActiveTab>('tags')\n\n  const exit = useAction(exitFullscreen)\n\n  useFullScreenCloseEffect(exit)\n\n  if (!isReaderOpen) {\n    return null\n  }\n\n  const { type, sample_url, file_url, preview_url, id, width, height, has_comments } = fullScreenPost\n\n  return (\n    <FullScreenDiv ref={setReaderRef}>\n      <Media\n        detailsVisible={false}\n        type={type}\n        thumbnailSrc={preview_url}\n        sampleSrc={sample_url}\n        fullSrc={file_url}\n        index={index}\n        onLoad={NO_OP}\n        width={width}\n        height={height}\n        isFullscreen\n      />\n      <Details postId={id} activeTab={activeTab} setActiveTab={setActiveTab} hasComments={has_comments} />\n    </FullScreenDiv>\n  )\n}\n","import { useEffect } from 'react'\r\n\r\nexport default function useFullScreenCloseEffect(effect: () => void) {\r\n  useEffect(() => {\r\n    const handler = () => {\r\n      if (!document.fullscreenElement) {\r\n        effect()\r\n      }\r\n    }\r\n\r\n    document.addEventListener('fullscreenchange', handler)\r\n\r\n    return () => {\r\n      document.removeEventListener('fullscreenchange', handler)\r\n    }\r\n  }, [effect])\r\n}\r\n","import React, { useCallback, useState } from 'react'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport InifinteColumn from '../layout/infinite/InfiniteColumn'\r\nimport { ListPost } from '../post/Post'\r\nimport { getMoreResults, getResults } from '../../redux/actions'\r\nimport {\r\n  selectHasMoreResults,\r\n  selectPageNumber,\r\n  selectPageSize,\r\n  selectPosts,\r\n  selectResultsLayout,\r\n} from '../../redux/selectors'\r\nimport LayoutHeader from '../layout/LayoutHeader'\r\nimport LayoutOutOfItems from '../layout/LayoutOutOfItems'\r\nimport LayoutLoadingItem from '../layout/LayoutLoadingItem'\r\nimport useAction from '../../hooks/useAction'\r\nimport PageLayout from '../layout/pages/PageLayout'\r\nimport Reader from '../reader/Reader'\r\n\r\nexport default function Search() {\r\n  const [isLoading, setLoading] = useState(false)\r\n\r\n  const posts = useSelector(selectPosts)\r\n  const hasMorePosts = useSelector(selectHasMoreResults)\r\n  const resultsLayout = useSelector(selectResultsLayout)\r\n  const pageSize = useSelector(selectPageSize)\r\n  const pageNumber = useSelector(selectPageNumber)\r\n\r\n  const dispatch = useDispatch()\r\n  const loadMore = useAction(getMoreResults)\r\n  const loadPage = useCallback((index: number) => dispatch(getResults(index)), [dispatch])\r\n\r\n  document.title = 'R34 React'\r\n\r\n  return (\r\n    <>\r\n      <Reader />\r\n      {resultsLayout === 'infinite_column' ? (\r\n        <InifinteColumn\r\n          Header={LayoutHeader}\r\n          OutOfItems={LayoutOutOfItems}\r\n          items={posts}\r\n          LoadingItem={LayoutLoadingItem}\r\n          hasMoreRows={hasMorePosts}\r\n          ItemComponent={ListPost}\r\n          loadMore={loadMore}\r\n          isLoading={isLoading}\r\n          setLoading={setLoading}\r\n        />\r\n      ) : (\r\n        <PageLayout\r\n          header={<LayoutHeader />}\r\n          pageSize={pageSize}\r\n          currentPage={pageNumber}\r\n          hasMorePages={hasMorePosts}\r\n          loadPage={loadPage}\r\n          ItemComponent={ListPost}\r\n          isLoading={isLoading}\r\n          setLoading={setLoading}\r\n          items={posts}\r\n        />\r\n      )}\r\n    </>\r\n  )\r\n}\r\n"],"sourceRoot":""}