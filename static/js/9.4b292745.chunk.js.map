{"version":3,"sources":["components/layout/stories/Story.tsx","components/pages/Stories.tsx"],"names":["Screen","styled","div","Story","props","index","onInView","onFinished","active","React","useState","ref","setRef","useIsOnScreen","isInView","useSelector","selectPostByIndex","type","preview_url","sample_url","file_url","width","height","useEffect","scrollIntoView","console","log","id","Media","thumbnailSrc","sampleSrc","fullSrc","onLoad","NO_OP","detailsVisible","isFullscreen","isActive","StoriesWrapper","Filler","css","Math","max","Stories","dispatch","useDispatch","history","useHistory","currentIdx","selectFullsceenIndex","nextIdx","indexes","setIndex","useCallback","setFullscreenPost","scrollToNext","document","getElementById","behavior","handler","fullscreenElement","goBack","addEventListener","passive","removeEventListener","openFullscreen","map"],"mappings":"yRAOMA,EAASC,IAAOC,IAAV,6IAgBG,SAASC,EAAMC,GAC5B,IAAQC,EAAgDD,EAAhDC,MAAOC,EAAyCF,EAAzCE,SAAUC,EAA+BH,EAA/BG,WAAzB,EAAwDH,EAAnBI,cAArC,SACA,EAAsBC,IAAMC,SAA6B,MAAzD,mBAAOC,EAAP,KAAYC,EAAZ,KACA,EAAmBC,YAAcF,GAA1BG,EAAP,oBACA,EAAmEC,YAAYC,YAAkBX,IAAzFY,EAAR,EAAQA,KAAMC,EAAd,EAAcA,YAAaC,EAA3B,EAA2BA,WAAYC,EAAvC,EAAuCA,SAAUC,EAAjD,EAAiDA,MAAOC,EAAxD,EAAwDA,OAexD,OAbAb,IAAMc,WAAU,WACVf,GAAUG,GACZA,EAAIa,mBAEL,CAAChB,EAAQG,IAEZF,IAAMc,WAAU,WACVjB,GAAYQ,IACdW,QAAQC,IAAI,SAAUrB,EAAO,cAC7BC,EAASD,MAEV,CAACA,EAAOS,EAAUR,IAGnB,cAACN,EAAD,CAAQ2B,GAAE,gBAAWtB,GAASM,IAAKC,EAAnC,SACE,cAACgB,EAAA,EAAD,CACEX,KAAMA,EACNZ,MAAOA,EACPwB,aAAcX,EACdY,UAAWX,EACXY,QAASX,EACTY,OAAQC,IACRZ,MAAOA,EACPC,OAAQA,EACRY,gBAAgB,EAChBC,cAAc,EACd5B,WAAYA,EACZ6B,SAAUtB,MC/ClB,IAAMuB,EAAiBpC,IAAOC,IAAV,sNAiBdoC,EAASrC,IAAOC,KACpB,gBAAGG,EAAH,EAAGA,MAAH,OAA4BkC,YAA3B,IAAD,+CACYC,KAAKC,IAAIpC,EAAQ,EAAG,OAInB,SAASqC,IACtB,IAAMC,EAAWC,cACXC,EAAUC,cAEhB,EAAsBrC,IAAMC,SAA6B,MAAzD,mBAAOC,EAAP,KAAYC,EAAZ,KAEMmC,EAAahC,YAAYiC,KACzBC,EAAUF,EAAa,EAGvBG,EAAU,CAFAH,EAAa,EAEHA,EAAYE,GAEhCE,EAAW1C,IAAM2C,aAAY,SAAC/C,GAAD,OAAmBsC,EAASU,YAAkBhD,MAAS,CAACsC,IAErFW,EAAe7C,IAAM2C,aAAY,WAAO,IAAD,EAC3C,UAAAG,SAASC,eAAT,gBAAiCP,WAAjC,SAA6CzB,eAAe,CAAEiC,SAAU,aACvE,CAACR,IAsBJ,OApBAxC,IAAMc,WAAU,WACd,IAAMmC,EAAU,WACTH,SAASI,mBACZd,EAAQe,UAMZ,OAFAL,SAASM,iBAAiB,mBAAoBH,EAAS,CAAEI,SAAS,IAE3D,WACLP,SAASQ,oBAAoB,mBAAoBL,MAElD,CAACb,IAEJpC,IAAMc,WAAU,WACVZ,GACFqD,YAAerD,KAEhB,CAACA,IAGF,eAAC0B,EAAD,CAAgB1B,IAAKC,EAArB,UACE,cAAC0B,EAAD,CAAQjC,MAAO0C,IACdG,EAAQe,KAAI,SAAC5D,GACZ,OAAIA,EAAQ,EAAU,KAClBA,EAAQ0C,GACR1C,EAAQ0C,EADmB,cAAC5C,EAAD,CAAmBE,MAAOA,EAAOC,SAAU6C,GAA/B9C,GAEpC,cAACF,EAAD,CAAmBE,MAAOA,EAAOE,WAAY+C,EAAc9C,QAAM,GAArDH","file":"static/js/9.4b292745.chunk.js","sourcesContent":["import React from 'react'\r\nimport { useSelector } from 'react-redux'\r\nimport styled from 'styled-components'\r\nimport { NO_OP } from '../../../data/types'\r\nimport useIsOnScreen from '../../../hooks/useIsOnScreen'\r\nimport { selectPostByIndex } from '../../../redux/selectors'\r\nimport { Media } from '../../player/Media'\r\nconst Screen = styled.div`\r\n  height: 100vh;\r\n  width: 100vw;\r\n  scroll-snap-align: start;\r\n  scroll-snap-stop: always;\r\n\r\n  display: grid;\r\n`\r\n\r\ninterface StoryProps {\r\n  index: number\r\n  onInView?: (index: number) => void\r\n  onFinished?: () => void\r\n  active?: boolean\r\n}\r\n\r\nexport default function Story(props: StoryProps) {\r\n  const { index, onInView, onFinished, active = false } = props\r\n  const [ref, setRef] = React.useState<HTMLElement | null>(null)\r\n  const [isInView] = useIsOnScreen(ref)\r\n  const { type, preview_url, sample_url, file_url, width, height } = useSelector(selectPostByIndex(index))\r\n\r\n  React.useEffect(() => {\r\n    if (active && ref) {\r\n      ref.scrollIntoView()\r\n    }\r\n  }, [active, ref])\r\n\r\n  React.useEffect(() => {\r\n    if (onInView && isInView) {\r\n      console.log('Index ', index, 'is in view')\r\n      onInView(index)\r\n    }\r\n  }, [index, isInView, onInView])\r\n\r\n  return (\r\n    <Screen id={`story-${index}`} ref={setRef}>\r\n      <Media\r\n        type={type}\r\n        index={index}\r\n        thumbnailSrc={preview_url}\r\n        sampleSrc={sample_url}\r\n        fullSrc={file_url}\r\n        onLoad={NO_OP}\r\n        width={width}\r\n        height={height}\r\n        detailsVisible={false}\r\n        isFullscreen={true}\r\n        onFinished={onFinished}\r\n        isActive={isInView}\r\n      />\r\n    </Screen>\r\n  )\r\n}\r\n","import React from 'react'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\nimport { useHistory } from 'react-router-dom'\r\nimport styled, { css } from 'styled-components'\r\nimport { openFullscreen } from '../../data/browserUtils'\r\nimport { setFullscreenPost } from '../../redux/actions'\r\nimport { selectFullsceenIndex } from '../../redux/selectors'\r\nimport Story from '../layout/stories/Story'\r\n\r\nconst StoriesWrapper = styled.div`\r\n  height: 100vh;\r\n  width: 100vw;\r\n  overflow: scroll;\r\n  scroll-snap-type: y mandatory;\r\n  scroll-snap-stop: always;\r\n\r\n  ::-webkit-scrollbar {\r\n    height: 0px;\r\n    width: 0px;\r\n  }\r\n`\r\n\r\ntype FillerProps = {\r\n  index: number\r\n}\r\n\r\nconst Filler = styled.div(\r\n  ({ index }: FillerProps) => css`\r\n    height: ${Math.max(index - 1, 0)}00vh;\r\n  `\r\n)\r\n\r\nexport default function Stories() {\r\n  const dispatch = useDispatch()\r\n  const history = useHistory()\r\n\r\n  const [ref, setRef] = React.useState<HTMLElement | null>(null)\r\n\r\n  const currentIdx = useSelector(selectFullsceenIndex)\r\n  const nextIdx = currentIdx + 1\r\n  const prevIdx = currentIdx - 1\r\n\r\n  const indexes = [prevIdx, currentIdx, nextIdx]\r\n\r\n  const setIndex = React.useCallback((index: number) => dispatch(setFullscreenPost(index)), [dispatch])\r\n\r\n  const scrollToNext = React.useCallback(() => {\r\n    document.getElementById(`story-${nextIdx}`)?.scrollIntoView({ behavior: 'smooth' })\r\n  }, [nextIdx])\r\n\r\n  React.useEffect(() => {\r\n    const handler = () => {\r\n      if (!document.fullscreenElement) {\r\n        history.goBack()\r\n      }\r\n    }\r\n\r\n    document.addEventListener('fullscreenchange', handler, { passive: true })\r\n\r\n    return () => {\r\n      document.removeEventListener('fullscreenchange', handler)\r\n    }\r\n  }, [history])\r\n\r\n  React.useEffect(() => {\r\n    if (ref) {\r\n      openFullscreen(ref)\r\n    }\r\n  }, [ref])\r\n\r\n  return (\r\n    <StoriesWrapper ref={setRef}>\r\n      <Filler index={currentIdx} />\r\n      {indexes.map((index) => {\r\n        if (index < 0) return null\r\n        if (index < currentIdx) return <Story key={index} index={index} onInView={setIndex} />\r\n        if (index > currentIdx) return <Story key={index} index={index} onInView={setIndex} />\r\n        return <Story key={index} index={index} onFinished={scrollToNext} active />\r\n      })}\r\n    </StoriesWrapper>\r\n  )\r\n}\r\n"],"sourceRoot":""}